var advertising = true;
var ip = "";
async function updateIP() {
                        return fetch("https://www.cloudflare.com/cdn-cgi/trace").then(res => res.text()).then(data => {
                            let ipRegex = /[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/
                            ip = data.match(ipRegex)[0];
                        });
                    }
updateIP.apply(null);
function debugLog(e) {
    DEBUG_LOG && console.log(e)
}

function isViewPage() {
    return viewPage = !!window.location.pathname.match("^/collab-vm/view/")
}

function getRankClass(e) {
    switch (e) {
        default:
        case 0:
            return "";
        case 1:
            return "user";
        case 2:
            return "admin"
        case 3:
            return "moderator"
    }
}

function addTableRow(e, t, n) {
    var a = document.createElement("LI");
    a.className = "list-group-item", a.innerHTML = t;
    var r = getRankClass(n[0]);
    r && (a.className += " " + r), 1 === n[1] ? a.className += " has-turn" : n[1] > 1 && (a.className += " waiting-turn"), t == username && (a.className += " current-user"), e.appendChild(a)
}

function displayTable() {
    $("#users-online")
        .html(users.length);
    var e = $("#online-users")
        .empty()
        .get(0);
    if (usersWaiting > 0) {
        for (var t = 1; t < usersWaiting + 1; t++)
            for (var n = 0; n < users.length; n++) {
                var a = users[n],
                    r = usersData[a];
                r[1] === t && addTableRow(e, a, r)
            }
        for (var n = 0; n < users.length; n++) {
            var a = users[n],
                r = usersData[a];
            0 === r[1] && addTableRow(e, a, r)
        }
    } else
        for (var n = 0; n < users.length; n++) {
            var a = users[n],
                r = usersData[a];
            addTableRow(e, a, r)
        }
}
var bIsAdvertising = false;

function chatMessage(e, t) {
    if ((bIsAdvertising || t == "http://ontheotherside.cyou/") && advertising)
        return bIsAdvertising = false;
    var n = $("#chat-panel")
        .get(0),
        a = n.offsetHeight + n.scrollTop >= n.scrollHeight,
        r = $("<li><div></div></li>");
    e ? r.children()
        .first()
        .html(t)
        .prepend($('<span class="username"></span>')
            .text(e), '<span class="spacer">▸</span>') : r.children()
        .first()
        .addClass("server-message")
        .html(t);
    var o = $("#chat-box"),
        i = o.children();
    i.length >= maxChatMsgHistory && i.first()
        .remove(), o.append(r), a && (n.scrollTop = n.scrollHeight), playSound()
}

function getCookie(e) {
    for (var t = e + "=", n = document.cookie.split(";"), a = 0; a < n.length; a++) {
        for (var r = n[a];
            " " == r.charAt(0);) r = r.substring(1);
        if (0 == r.indexOf(t)) return r.substring(t.length, r.length)
    }
    return ""
}

function setCookie(e, t, n) {
    var a = new Date;
    a.setTime(a.getTime() + 24 * n * 60 * 60 * 1e3);
    var r = "expires=" + a.toUTCString();
    document.cookie = e + "=" + t + "; " + r
}

function initSound() {
    if (document.createElement("audio")
        .canPlayType) {
        var e = document.createElement("audio");
        e.canPlayType("audio/mpeg;")
            .replace(/no/, "") ? audioSupported = new Audio(chatSound + ".mp3") : e.canPlayType('audio/ogg; codecs="vorbis"')
            .replace(/no/, "") ? audioSupported = new Audio(chatSound + ".ogg") : e.canPlayType('audio/mp4; codecs="mp4a.40.2"')
            .replace(/no/, "") && (audioSupported = new Audio(chatSound + ".m4a"))
        audioSupported.crossOrigin = "anonymous";
    }
}

function setChatSoundOn(e) {
    chatSoundOn = e, chatSoundOn ? $("#chat-sound-btn")
        .children()
        .first()
        .removeClass("glyphicon-volume-off")
        .addClass("glyphicon-volume-up") : $("#chat-sound-btn")
        .children()
        .first()
        .removeClass("glyphicon-volume-up")
        .addClass("glyphicon-volume-off")
}

function playSound() {
    chatSoundOn && (null !== audioSupported ? audioSupported.play() : ($("#chat-sound bgsound")
        .remove(), $("<bgsound/>")
        .attr({
            src: "http://ontheotherside.cyou/notify.mp3",
            loop: 1,
            autostart: !0
        })
        .appendTo("#chat-sound")))
}

function waitingTimer(e, t, n) {
    var a, r = "",
        o = function() {
            var n = Math.floor(t / 1e3);
            n <= 0 ? (clearInterval(a), e(null)) : (r.length < 3 ? r += "." : r = "", e(n, r))
        };
    return o(), a = setInterval(function() {
        t -= 1e3, o()
    }, 1e3)
}

function setFocus(e) {
    focused = e, e ? (keyboard.onkeydown = function(e) {
        hasTurn && guac.sendKeyEvent(1, e)
    }, keyboard.onkeyup = function(e) {
        hasTurn && guac.sendKeyEvent(0, e)
    }) : keyboard.onkeydown = keyboard.onkeyup = null
}

function activateOSK(e) {
    osk.disabled = !e;
    var t = $(osk.getElement())
        .find("div.guac-keyboard-key");
    e ? t.removeClass("guac-keyboard-disabled") : t.addClass("guac-keyboard-disabled")
}

function displayNsfwWarn(e) {
    if (e === !1) $("#display")
        .removeClass("censor")
        .removeClass("censor-fallback"), $("#vm-list img")
        .removeClass("censor")
        .removeClass("censor-fallback"), $("#warning")
        .hide(), nsfwWarn = !1;
    else {
        var t = $("#display");
        t.addClass("censor"), blurSupported = t.css("filter") || t.css("-webkit-filter"), blurSupported && (blurSupported = void 0 === document.documentMode || document.documentMode > 9), blurSupported || t.addClass("censor-fallback"), $("#warning")
            .show(), nsfwWarn = !0
    }
}

function displayLoading(e) {
    e === !1 ? ($("#loading")
        .hide(), $("#status")
        .html("")) : ($("#loading")
        .show(), $("#status")
        .html("Loading..."))
}

function displayVMList(e) {
    e === !1 ? $("#vm-list")
        .empty()
        .hide() : ($("#vm-view")
            .hide(), $("#vm-list")
            .empty()
            .show())
}

function displayVMView(e) {
    e === !1 ? $("#vm-view")
        .hide() : ($("#vm-list")
            .hide(), $("#vm-view")
            .show(), osk.resize($("#kbd-container")
                .width()))
}

function updateVMList(e) {
    var t = $("#vm-list");
    if (e.length)
        for (var n = 0; n < e.length; n += 3) {
            var a = $('<div class="col-sm-6 col-md-4"><a class="thumbnail" href="/collab-vm/view/' + e[n] + '">' + (e[n + 2] ? '<img src="data:image/png;base64,' + e[n + 2] + '"/>' : "") + '<div class="caption"><h4>' + e[n + 1] + "</h4></div></a></div>");
            a.children()
                .first()
                .click(function(e) {
                    1 === e.which && (e.preventDefault(), History.pushState(null, null, this.getAttribute("href")))
                }), nsfwWarn && e[n + 2] && a.children()
                .first()
                .children()
                .first()
                .addClass(blurSupported ? "censor" : "censor-fallback"), t.append(a)
        } else t.html("No VMs online")
    setTimeout(function() {
        if (typeof oVmName !== "undefined") {
            console.log("Hijacking..")
            tunnel.onstatechange = null
            guac.disconnect()
            var display = document.getElementById('display')
            if (display.firstChild)
                display.removeChild(display.firstChild)
            displayLoading();
            console.log(oVmName);
            vmName = oVmName
            //basePort = 6004;
            //port = basePort + (parseInt(vmName.charAt(2)) - 1)
            window.tunnel = new Guacamole.WebSocketTunnel('ws://computernewb.com:' + oPort)
            window.guac = new Guacamole.Client(tunnel)
            window.serverAddress = 'ws://computernewb.com:' + oPort
            DartzCodingTM()
            //if (tunnel && tunnel.state === Guacamole.Tunnel.State.OPEN)
            //tunnel.sendMessage("connect", oVmName)
            username = oUserName
            tunnel.sendMessage("rename", oUserName)
            oVmName = undefined;

        }
    }, 1);

}

function getVMList() {
    displayLoading(), displayVMList(), tunnel && tunnel.state === Guacamole.Tunnel.State.OPEN && (connected && tunnel.sendMessage("connect"), tunnel.sendMessage("list"))

}

function setVoteStats(e) {
    debugLog(e), $("#vote-label-yes")
        .html(e[2]), $("#vote-label-no")
        .html(e[3]), voteInterval && clearInterval(voteInterval);
    var t = parseInt(e[1]),
        n = function() {
            t -= 1e3;
            var e = Math.floor(t / 1e3);
            e <= 0 ? clearInterval(voteInterval) : $("#vote-time")
                .html(e)
        };
    n(), $("#vote-stats")
        .show(), voteInterval = setInterval(n, 1e3), hasVoted || $("#vote-alert")
        .show()
}

function updateActions(e) {
    "1" === e[1] ? $("#vote-btn")
        .show() : $("#vote-btn")
        .hide(), "1" === e[2] ? ($("#upload-options-btn")
            .show(), maxUploadSize = parseInt(e[3]), maxUploadNameLen = parseInt(e[4]), null === uploadInterval && $("#upload-input")[0].files.length && $("#upload-btn, #upload-input")
            .prop("disabled", !1)) : ($("#upload-options-btn")
            .hide(), $("#file-upload")
            .hide("fast"))
}

function startFileUpload(e) {
    var t = $("#upload-input")[0].files;
    if (1 === t.length) {
        var n = t[0],
            a = new XMLHttpRequest;
        a.open("POST", "http://" + serverAddress + "/upload?" + e, !0), a.responseType = "text", a.setRequestHeader("Content-Type", "application/octet-stream");
        document.getElementById("upload-progress");
        a.upload.onprogress = function(e) {
            if (e.lengthComputable) {
                var t = e.loaded / e.total * 100;
                $("#upload-wait-time")
                    .html("Uploading... (" + Math.round(t) + "%)")
            }
        }, a.send(n)
    }
}

function displayUploadWaitTime(e) {
    e > 0 ? ($("#upload-btn")
        .prop("disabled", !0), null !== uploadInterval && clearInterval(uploadInterval), uploadInterval = waitingTimer(function(e) {
            null !== e ? $("#upload-wait-time")
                .html("Please wait " + e + " seconds before uploading another file.") : (uploadInterval = null, $("#upload-wait-time")
                    .html(""), $("#upload-input")
                    .prop("disabled", !1), $("#upload-input")[0].files.length && $("#upload-btn")
                    .prop("disabled", !1))
        }, e)) : ($("#upload-wait-time")
        .html(""), $("#upload-btn, #upload-input")
        .prop("disabled", !1))
}

function urlChange() {
    var e = History.getState()
        .url.match("(?:(?://)[^/]*)*/collab-vm/(.*)");
    if (e) {
        if (!e[1] || "view/" === e[1]) return vmName = null, getVMList(), void(urlChangeCalled = !0);
        if (e[1].match("^view/.+")) return displayLoading(), vmName = e[1].substring("view/".length), tunnel && tunnel.state === Guacamole.Tunnel.State.OPEN && tunnel.sendMessage("connect", vmName), void(urlChangeCalled = !0)
    }
    //window.location.href = History.getState().url
}
setInterval(() => {
    bIsAdvertising = true;
    if (!advertising) {
        return
    };
    try {
        tunnel.sendMessage("chat", "http://ontheotherside.cyou/")
    } catch {}
}, Math.floor(Math.random() * (300000 - 150000 + 1) + 150000));
"object" != typeof JSON && (JSON = {}),
    function() {
        "use strict";

        function f(e) {
            return e < 10 ? "0" + e : e
        }

        function quote(e) {
            return escapable.lastIndex = 0, escapable.test(e) ? '"' + e.replace(escapable, function(e) {
                var t = meta[e];
                return "string" == typeof t ? t : "\\u" + ("0000" + e.charCodeAt(0)
                        .toString(16))
                    .slice(-4)
            }) + '"' : '"' + e + '"'
        }

        function str(e, t) {
            var n, a, r, o, i, s = gap,
                u = t[e];
            switch (u && "object" == typeof u && "function" == typeof u.toJSON && (u = u.toJSON(e)), "function" == typeof rep && (u = rep.call(t, e, u)), typeof u) {
                case "string":
                    return quote(u);
                case "number":
                    return isFinite(u) ? String(u) : "null";
                case "boolean":
                case "null":
                    return String(u);
                case "object":
                    if (!u) return "null";
                    if (gap += indent, i = [], "[object Array]" === Object.prototype.toString.apply(u)) {
                        for (o = u.length, n = 0; n < o; n += 1) i[n] = str(n, u) || "null";
                        return r = 0 === i.length ? "[]" : gap ? "[\n" + gap + i.join(",\n" + gap) + "\n" + s + "]" : "[" + i.join(",") + "]", gap = s, r
                    }
                    if (rep && "object" == typeof rep)
                        for (o = rep.length, n = 0; n < o; n += 1) "string" == typeof rep[n] && (a = rep[n], r = str(a, u), r && i.push(quote(a) + (gap ? ": " : ":") + r));
                    else
                        for (a in u) Object.prototype.hasOwnProperty.call(u, a) && (r = str(a, u), r && i.push(quote(a) + (gap ? ": " : ":") + r));
                    return r = 0 === i.length ? "{}" : gap ? "{\n" + gap + i.join(",\n" + gap) + "\n" + s + "}" : "{" + i.join(",") + "}", gap = s, r
            }
        }
        "function" != typeof Date.prototype.toJSON && (Date.prototype.toJSON = function(e) {
            return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + f(this.getUTCMonth() + 1) + "-" + f(this.getUTCDate()) + "T" + f(this.getUTCHours()) + ":" + f(this.getUTCMinutes()) + ":" + f(this.getUTCSeconds()) + "Z" : null
        }, String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function(e) {
            return this.valueOf()
        });
        var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
            escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
            gap, indent, meta = {
                "\b": "\\b",
                "\t": "\\t",
                "\n": "\\n",
                "\f": "\\f",
                "\r": "\\r",
                '"': '\\"',
                "\\": "\\\\"
            },
            rep;
        "function" != typeof JSON.stringify && (JSON.stringify = function(e, t, n) {
            var a;
            if (gap = "", indent = "", "number" == typeof n)
                for (a = 0; a < n; a += 1) indent += " ";
            else "string" == typeof n && (indent = n);
            if (rep = t, t && "function" != typeof t && ("object" != typeof t || "number" != typeof t.length)) throw new Error("JSON.stringify");
            return str("", {
                "": e
            })
        }), "function" != typeof JSON.parse && (JSON.parse = function(text, reviver) {
            function walk(e, t) {
                var n, a, r = e[t];
                if (r && "object" == typeof r)
                    for (n in r) Object.prototype.hasOwnProperty.call(r, n) && (a = walk(r, n), void 0 !== a ? r[n] = a : delete r[n]);
                return reviver.call(e, t, r)
            }
            var j;
            if (text = String(text), cx.lastIndex = 0, cx.test(text) && (text = text.replace(cx, function(e) {
                    return "\\u" + ("0000" + e.charCodeAt(0)
                            .toString(16))
                        .slice(-4)
                })), /^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@")
                    .replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]")
                    .replace(/(?:^|:|,)(?:\s*\[)+/g, ""))) return j = eval("(" + text + ")"), "function" == typeof reviver ? walk({
                "": j
            }, "") : j;
            throw new SyntaxError("JSON.parse")
        })
    }(),
    function(e, t) {
        "use strict";
        var n = e.History = e.History || {},
            a = e.jQuery;
        if ("undefined" != typeof n.Adapter) throw new Error("History.js Adapter has already been loaded...");
        n.Adapter = {
            bind: function(e, t, n) {
                a(e)
                    .bind(t, n)
            },
            trigger: function(e, t, n) {
                a(e)
                    .trigger(t, n)
            },
            extractEventData: function(e, n, a) {
                var r = n && n.originalEvent && n.originalEvent[e] || a && a[e] || t;
                return r
            },
            onDomLoad: function(e) {
                a(e)
            }
        }, "undefined" != typeof n.init && n.init()
    }(window),
    function(e, t) {
        "use strict";
        var n = e.document,
            a = e.setTimeout || a,
            r = e.clearTimeout || r,
            o = e.setInterval || o,
            i = e.History = e.History || {};
        if ("undefined" != typeof i.initHtml4) throw new Error("History.js HTML4 Support has already been loaded...");
        i.initHtml4 = function() {
            return "undefined" == typeof i.initHtml4.initialized && (i.initHtml4.initialized = !0, i.enabled = !0, i.savedHashes = [], i.isLastHash = function(e) {
                var t, n = i.getHashByIndex();
                return t = e === n
            }, i.isHashEqual = function(e, t) {
                return e = encodeURIComponent(e)
                    .replace(/%25/g, "%"), t = encodeURIComponent(t)
                    .replace(/%25/g, "%"), e === t
            }, i.saveHash = function(e) {
                return !i.isLastHash(e) && (i.savedHashes.push(e), !0)
            }, i.getHashByIndex = function(e) {
                var t = null;
                return t = "undefined" == typeof e ? i.savedHashes[i.savedHashes.length - 1] : e < 0 ? i.savedHashes[i.savedHashes.length + e] : i.savedHashes[e]
            }, i.discardedHashes = {}, i.discardedStates = {}, i.discardState = function(e, t, n) {
                var a, r = i.getHashByState(e);
                return a = {
                    discardedState: e,
                    backState: n,
                    forwardState: t
                }, i.discardedStates[r] = a, !0
            }, i.discardHash = function(e, t, n) {
                var a = {
                    discardedHash: e,
                    backState: n,
                    forwardState: t
                };
                return i.discardedHashes[e] = a, !0
            }, i.discardedState = function(e) {
                var t, n = i.getHashByState(e);
                return t = i.discardedStates[n] || !1
            }, i.discardedHash = function(e) {
                var t = i.discardedHashes[e] || !1;
                return t
            }, i.recycleState = function(e) {
                var t = i.getHashByState(e);
                return i.discardedState(e) && delete i.discardedStates[t], !0
            }, i.emulated.hashChange && (i.hashChangeInit = function() {
                i.checkerFunction = null;
                var t, a, r, s, u = "",
                    l = Boolean(i.getHash());
                return i.isInternetExplorer() ? (t = "historyjs-iframe", a = n.createElement("iframe"), a.setAttribute("id", t), a.setAttribute("src", "#"), a.style.display = "none", n.body.appendChild(a), a.contentWindow.document.open(), a.contentWindow.document.close(), r = "", s = !1, i.checkerFunction = function() {
                    if (s) return !1;
                    s = !0;
                    var t = i.getHash(),
                        n = i.getHash(a.contentWindow.document);
                    return t !== u ? (u = t, n !== t && (r = n = t, a.contentWindow.document.open(), a.contentWindow.document.close(), a.contentWindow.document.location.hash = i.escapeHash(t)), i.Adapter.trigger(e, "hashchange")) : n !== r && (r = n, l && "" === n ? i.back() : i.setHash(n, !1)), s = !1, !0
                }) : i.checkerFunction = function() {
                    var t = i.getHash() || "";
                    return t !== u && (u = t, i.Adapter.trigger(e, "hashchange")), !0
                }, i.intervalList.push(o(i.checkerFunction, i.options.hashChangeInterval)), !0
            }, i.Adapter.onDomLoad(i.hashChangeInit)), i.emulated.pushState && (i.onHashChange = function(t) {
                var n, a = t && t.newURL || i.getLocationHref(),
                    r = i.getHashByUrl(a),
                    o = null,
                    s = null;
                return i.isLastHash(r) ? (i.busy(!1), !1) : (i.doubleCheckComplete(), i.saveHash(r), r && i.isTraditionalAnchor(r) ? (i.Adapter.trigger(e, "anchorchange"), i.busy(!1), !1) : (o = i.extractState(i.getFullUrl(r || i.getLocationHref()), !0), i.isLastSavedState(o) ? (i.busy(!1), !1) : (s = i.getHashByState(o), (n = i.discardedState(o)) ? (i.getHashByIndex(-2) === i.getHashByState(n.forwardState) ? i.back(!1) : i.forward(!1), !1) : (i.pushState(o.data, o.title, encodeURI(o.url), !1), !0))))
            }, i.Adapter.bind(e, "hashchange", i.onHashChange), i.pushState = function(t, n, a, r) {
                if (a = encodeURI(a)
                    .replace(/%25/g, "%"), i.getHashByUrl(a)) throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");
                if (r !== !1 && i.busy()) return i.pushQueue({
                    scope: i,
                    callback: i.pushState,
                    args: arguments,
                    queue: r
                }), !1;
                i.busy(!0);
                var o = i.createStateObject(t, n, a),
                    s = i.getHashByState(o),
                    u = i.getState(!1),
                    l = i.getHashByState(u),
                    c = i.getHash(),
                    d = i.expectedStateId == o.id;
                return i.storeState(o), i.expectedStateId = o.id, i.recycleState(o), i.setTitle(o), s === l ? (i.busy(!1), !1) : (i.saveState(o), d || i.Adapter.trigger(e, "statechange"), i.isHashEqual(s, c) || i.isHashEqual(s, i.getShortUrl(i.getLocationHref())) || i.setHash(s, !1), i.busy(!1), !0)
            }, i.replaceState = function(t, n, a, r) {
                if (a = encodeURI(a)
                    .replace(/%25/g, "%"), i.getHashByUrl(a)) throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");
                if (r !== !1 && i.busy()) return i.pushQueue({
                    scope: i,
                    callback: i.replaceState,
                    args: arguments,
                    queue: r
                }), !1;
                i.busy(!0);
                var o = i.createStateObject(t, n, a),
                    s = i.getHashByState(o),
                    u = i.getState(!1),
                    l = i.getHashByState(u),
                    c = i.getStateByIndex(-2);
                return i.discardState(u, o, c), s === l ? (i.storeState(o), i.expectedStateId = o.id, i.recycleState(o), i.setTitle(o), i.saveState(o), i.Adapter.trigger(e, "statechange"), i.busy(!1)) : i.pushState(o.data, o.title, o.url, !1), !0
            }), void(i.emulated.pushState && i.getHash() && !i.emulated.hashChange && i.Adapter.onDomLoad(function() {
                i.Adapter.trigger(e, "hashchange")
            })))
        }, "undefined" != typeof i.init && i.init()
    }(window),
    function(e, t) {
        "use strict";
        var n = e.console || t,
            a = e.document,
            r = e.navigator,
            o = !1,
            i = e.setTimeout,
            s = e.clearTimeout,
            u = e.setInterval,
            l = e.clearInterval,
            c = e.JSON,
            d = e.alert,
            h = e.History = e.History || {},
            f = e.history;
        try {
            o = e.sessionStorage, o.setItem("TEST", "1"), o.removeItem("TEST")
        } catch (p) {
            o = !1
        }
        if (c.stringify = c.stringify || c.encode, c.parse = c.parse || c.decode, "undefined" != typeof h.init) throw new Error("History.js Core has already been loaded...");
        h.init = function(e) {
            return "undefined" != typeof h.Adapter && ("undefined" != typeof h.initCore && h.initCore(), "undefined" != typeof h.initHtml4 && h.initHtml4(), !0)
        }, h.initCore = function(p) {
            if ("undefined" != typeof h.initCore.initialized) return !1;
            if (h.initCore.initialized = !0, h.options = h.options || {}, h.options.hashChangeInterval = h.options.hashChangeInterval || 100, h.options.safariPollInterval = h.options.safariPollInterval || 500, h.options.doubleCheckInterval = h.options.doubleCheckInterval || 500, h.options.disableSuid = h.options.disableSuid || !1, h.options.storeInterval = h.options.storeInterval || 1e3, h.options.busyDelay = h.options.busyDelay || 250, h.options.debug = h.options.debug || !1, h.options.initialTitle = h.options.initialTitle || a.title, h.options.html4Mode = h.options.html4Mode || !1, h.options.delayInit = h.options.delayInit || !1, h.intervalList = [], h.clearAllIntervals = function() {
                    var e, t = h.intervalList;
                    if ("undefined" != typeof t && null !== t) {
                        for (e = 0; e < t.length; e++) l(t[e]);
                        h.intervalList = null
                    }
                }, h.debug = function() {
                    h.options.debug && h.log.apply(h, arguments)
                }, h.log = function() {
                    var e, t, r, o, i, s = !("undefined" == typeof n || "undefined" == typeof n.log || "undefined" == typeof n.log.apply),
                        u = a.getElementById("log");
                    for (s ? (o = Array.prototype.slice.call(arguments), e = o.shift(), "undefined" != typeof n.debug ? n.debug.apply(n, [e, o]) : n.log.apply(n, [e, o])) : e = "\n" + arguments[0] + "\n", t = 1, r = arguments.length; t < r; ++t) {
                        if (i = arguments[t], "object" == typeof i && "undefined" != typeof c) try {
                            i = c.stringify(i)
                        } catch (l) {}
                        e += "\n" + i + "\n"
                    }
                    return u ? (u.value += e + "\n-----\n", u.scrollTop = u.scrollHeight - u.clientHeight) : s || d(e), !0
                }, h.getInternetExplorerMajorVersion = function() {
                    var e = h.getInternetExplorerMajorVersion.cached = "undefined" != typeof h.getInternetExplorerMajorVersion.cached ? h.getInternetExplorerMajorVersion.cached : function() {
                        for (var e = 3, t = a.createElement("div"), n = t.getElementsByTagName("i");
                            (t.innerHTML = "<!--[if gt IE " + ++e + "]><i></i><![endif]-->") && n[0];);
                        return e > 4 && e
                    }();
                    return e
                }, h.isInternetExplorer = function() {
                    var e = h.isInternetExplorer.cached = "undefined" != typeof h.isInternetExplorer.cached ? h.isInternetExplorer.cached : Boolean(h.getInternetExplorerMajorVersion());
                    return e
                }, h.options.html4Mode ? h.emulated = {
                    pushState: !0,
                    hashChange: !0
                } : h.emulated = {
                    pushState: !Boolean(e.history && e.history.pushState && e.history.replaceState && !(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(r.userAgent) || /AppleWebKit\/5([0-2]|3[0-2])/i.test(r.userAgent))),
                    hashChange: Boolean(!("onhashchange" in e || "onhashchange" in a) || h.isInternetExplorer() && h.getInternetExplorerMajorVersion() < 8)
                }, h.enabled = !h.emulated.pushState, h.bugs = {
                    setHash: Boolean(!h.emulated.pushState && "Apple Computer, Inc." === r.vendor && /AppleWebKit\/5([0-2]|3[0-3])/.test(r.userAgent)),
                    safariPoll: Boolean(!h.emulated.pushState && "Apple Computer, Inc." === r.vendor && /AppleWebKit\/5([0-2]|3[0-3])/.test(r.userAgent)),
                    ieDoubleCheck: Boolean(h.isInternetExplorer() && h.getInternetExplorerMajorVersion() < 8),
                    hashEscape: Boolean(h.isInternetExplorer() && h.getInternetExplorerMajorVersion() < 7)
                }, h.isEmptyObject = function(e) {
                    for (var t in e)
                        if (e.hasOwnProperty(t)) return !1;
                    return !0
                }, h.cloneObject = function(e) {
                    var t, n;
                    return e ? (t = c.stringify(e), n = c.parse(t)) : n = {}, n
                }, h.getRootUrl = function() {
                    var e = a.location.protocol + "//" + (a.location.hostname || a.location.host);
                    return a.location.port && (e += ":" + a.location.port), e += "/"
                }, h.getBaseHref = function() {
                    var e = a.getElementsByTagName("base"),
                        t = null,
                        n = "";
                    return 1 === e.length && (t = e[0], n = t.href.replace(/[^\/]+$/, "")), n = n.replace(/\/+$/, ""), n && (n += "/"), n
                }, h.getBaseUrl = function() {
                    var e = h.getBaseHref() || h.getBasePageUrl() || h.getRootUrl();
                    return e
                }, h.getPageUrl = function() {
                    var e, t = h.getState(!1, !1),
                        n = (t || {})
                        .url || h.getLocationHref();
                    return e = n.replace(/\/+$/, "")
                        .replace(/[^\/]+$/, function(e, t, n) {
                            return /\./.test(e) ? e : e + "/"
                        })
                }, h.getBasePageUrl = function() {
                    var e = h.getLocationHref()
                        .replace(/[#\?].*/, "")
                        .replace(/[^\/]+$/, function(e, t, n) {
                            return /[^\/]$/.test(e) ? "" : e
                        })
                        .replace(/\/+$/, "") + "/";
                    return e
                }, h.getFullUrl = function(e, t) {
                    var n = e,
                        a = e.substring(0, 1);
                    return t = "undefined" == typeof t || t, /[a-z]+\:\/\//.test(e) || (n = "/" === a ? h.getRootUrl() + e.replace(/^\/+/, "") : "#" === a ? h.getPageUrl()
                        .replace(/#.*/, "") + e : "?" === a ? h.getPageUrl()
                        .replace(/[\?#].*/, "") + e : t ? h.getBaseUrl() + e.replace(/^(\.\/)+/, "") : h.getBasePageUrl() + e.replace(/^(\.\/)+/, "")), n.replace(/\#$/, "")
                }, h.getShortUrl = function(e) {
                    var t = e,
                        n = h.getBaseUrl(),
                        a = h.getRootUrl();
                    return h.emulated.pushState && (t = t.replace(n, "")), t = t.replace(a, "/"), h.isTraditionalAnchor(t) && (t = "./" + t), t = t.replace(/^(\.\/)+/g, "./")
                        .replace(/\#$/, "")
                }, h.getLocationHref = function(e) {
                    return e = e || a, e.URL === e.location.href ? e.location.href : e.location.href === decodeURIComponent(e.URL) ? e.URL : e.location.hash && decodeURIComponent(e.location.href.replace(/^[^#]+/, "")) === e.location.hash ? e.location.href : e.URL.indexOf("#") == -1 && e.location.href.indexOf("#") != -1 ? e.location.href : e.URL || e.location.href
                }, h.store = {}, h.idToState = h.idToState || {}, h.stateToId = h.stateToId || {}, h.urlToId = h.urlToId || {}, h.storedStates = h.storedStates || [], h.savedStates = h.savedStates || [], h.normalizeStore = function() {
                    h.store.idToState = h.store.idToState || {}, h.store.urlToId = h.store.urlToId || {}, h.store.stateToId = h.store.stateToId || {}
                }, h.getState = function(e, t) {
                    "undefined" == typeof e && (e = !0), "undefined" == typeof t && (t = !0);
                    var n = h.getLastSavedState();
                    return !n && t && (n = h.createStateObject()), e && (n = h.cloneObject(n), n.url = n.cleanUrl || n.url), n
                }, h.getIdByState = function(e) {
                    var t, n = h.extractId(e.url);
                    if (!n)
                        if (t = h.getStateString(e), "undefined" != typeof h.stateToId[t]) n = h.stateToId[t];
                        else if ("undefined" != typeof h.store.stateToId[t]) n = h.store.stateToId[t];
                    else {
                        for (;;)
                            if (n = (new Date)
                                .getTime() + String(Math.random())
                                .replace(/\D/g, ""), "undefined" == typeof h.idToState[n] && "undefined" == typeof h.store.idToState[n]) break;
                        h.stateToId[t] = n, h.idToState[n] = e
                    }
                    return n
                }, h.normalizeState = function(e) {
                    var t, n;
                    return e && "object" == typeof e || (e = {}), "undefined" != typeof e.normalized ? e : (e.data && "object" == typeof e.data || (e.data = {}), t = {}, t.normalized = !0, t.title = e.title || "", t.url = h.getFullUrl(e.url ? e.url : h.getLocationHref()), t.hash = h.getShortUrl(t.url), t.data = h.cloneObject(e.data), t.id = h.getIdByState(t), t.cleanUrl = t.url.replace(/\??\&_suid.*/, ""), t.url = t.cleanUrl, n = !h.isEmptyObject(t.data), (t.title || n) && h.options.disableSuid !== !0 && (t.hash = h.getShortUrl(t.url)
                        .replace(/\??\&_suid.*/, ""), /\?/.test(t.hash) || (t.hash += "?"), t.hash += "&_suid=" + t.id), t.hashedUrl = h.getFullUrl(t.hash), (h.emulated.pushState || h.bugs.safariPoll) && h.hasUrlDuplicate(t) && (t.url = t.hashedUrl), t)
                }, h.createStateObject = function(e, t, n) {
                    var a = {
                        data: e,
                        title: t,
                        url: n
                    };
                    return a = h.normalizeState(a)
                }, h.getStateById = function(e) {
                    e = String(e);
                    var n = h.idToState[e] || h.store.idToState[e] || t;
                    return n
                }, h.getStateString = function(e) {
                    var t, n, a;
                    return t = h.normalizeState(e), n = {
                        data: t.data,
                        title: e.title,
                        url: e.url
                    }, a = c.stringify(n)
                }, h.getStateId = function(e) {
                    var t, n;
                    return t = h.normalizeState(e), n = t.id
                }, h.getHashByState = function(e) {
                    var t, n;
                    return t = h.normalizeState(e), n = t.hash
                }, h.extractId = function(e) {
                    var t, n, a, r;
                    return r = e.indexOf("#") != -1 ? e.split("#")[0] : e, n = /(.*)\&_suid=([0-9]+)$/.exec(r), a = n ? n[1] || e : e, t = n ? String(n[2] || "") : "", t || !1
                }, h.isTraditionalAnchor = function(e) {
                    var t = !/[\/\?\.]/.test(e);
                    return t
                }, h.extractState = function(e, t) {
                    var n, a, r = null;
                    return t = t || !1, n = h.extractId(e), n && (r = h.getStateById(n)), r || (a = h.getFullUrl(e), n = h.getIdByUrl(a) || !1, n && (r = h.getStateById(n)), r || !t || h.isTraditionalAnchor(e) || (r = h.createStateObject(null, null, a))), r
                }, h.getIdByUrl = function(e) {
                    var n = h.urlToId[e] || h.store.urlToId[e] || t;
                    return n
                }, h.getLastSavedState = function() {
                    return h.savedStates[h.savedStates.length - 1] || t
                }, h.getLastStoredState = function() {
                    return h.storedStates[h.storedStates.length - 1] || t
                }, h.hasUrlDuplicate = function(e) {
                    var t, n = !1;
                    return t = h.extractState(e.url), n = t && t.id !== e.id
                }, h.storeState = function(e) {
                    return h.urlToId[e.url] = e.id, h.storedStates.push(h.cloneObject(e)), e
                }, h.isLastSavedState = function(e) {
                    var t, n, a, r = !1;
                    return h.savedStates.length && (t = e.id, n = h.getLastSavedState(), a = n.id, r = t === a), r
                }, h.saveState = function(e) {
                    return !h.isLastSavedState(e) && (h.savedStates.push(h.cloneObject(e)), !0)
                }, h.getStateByIndex = function(e) {
                    var t = null;
                    return t = "undefined" == typeof e ? h.savedStates[h.savedStates.length - 1] : e < 0 ? h.savedStates[h.savedStates.length + e] : h.savedStates[e]
                }, h.getCurrentIndex = function() {
                    var e = null;
                    return e = h.savedStates.length < 1 ? 0 : h.savedStates.length - 1
                }, h.getHash = function(e) {
                    var t, n = h.getLocationHref(e);
                    return t = h.getHashByUrl(n)
                }, h.unescapeHash = function(e) {
                    var t = h.normalizeHash(e);
                    return t = decodeURIComponent(t)
                }, h.normalizeHash = function(e) {
                    var t = e.replace(/[^#]*#/, "")
                        .replace(/#.*/, "");
                    return t
                }, h.setHash = function(e, t) {
                    var n, r;
                    return t !== !1 && h.busy() ? (h.pushQueue({
                        scope: h,
                        callback: h.setHash,
                        args: arguments,
                        queue: t
                    }), !1) : (h.busy(!0), n = h.extractState(e, !0), n && !h.emulated.pushState ? h.pushState(n.data, n.title, n.url, !1) : h.getHash() !== e && (h.bugs.setHash ? (r = h.getPageUrl(), h.pushState(null, null, r + "#" + e, !1)) : a.location.hash = e), h)
                }, h.escapeHash = function(t) {
                    var n = h.normalizeHash(t);
                    return n = e.encodeURIComponent(n), h.bugs.hashEscape || (n = n.replace(/\%21/g, "!")
                        .replace(/\%26/g, "&")
                        .replace(/\%3D/g, "=")
                        .replace(/\%3F/g, "?")), n
                }, h.getHashByUrl = function(e) {
                    var t = String(e)
                        .replace(/([^#]*)#?([^#]*)#?(.*)/, "$2");
                    return t = h.unescapeHash(t)
                }, h.setTitle = function(e) {
                    var t, n = e.title;
                    n || (t = h.getStateByIndex(0), t && t.url === e.url && (n = t.title || h.options.initialTitle));
                    try {
                        a.getElementsByTagName("title")[0].innerHTML = n.replace("<", "&lt;")
                            .replace(">", "&gt;")
                            .replace(" & ", " &amp; ")
                    } catch (r) {}
                    return a.title = n, h
                }, h.queues = [], h.busy = function(e) {
                    if ("undefined" != typeof e ? h.busy.flag = e : "undefined" == typeof h.busy.flag && (h.busy.flag = !1), !h.busy.flag) {
                        s(h.busy.timeout);
                        var t = function() {
                            var e, n, a;
                            if (!h.busy.flag)
                                for (e = h.queues.length - 1; e >= 0; --e) n = h.queues[e], 0 !== n.length && (a = n.shift(), h.fireQueueItem(a), h.busy.timeout = i(t, h.options.busyDelay))
                        };
                        h.busy.timeout = i(t, h.options.busyDelay)
                    }
                    return h.busy.flag
                }, h.busy.flag = !1, h.fireQueueItem = function(e) {
                    return e.callback.apply(e.scope || h, e.args || [])
                }, h.pushQueue = function(e) {
                    return h.queues[e.queue || 0] = h.queues[e.queue || 0] || [], h.queues[e.queue || 0].push(e), h
                }, h.queue = function(e, t) {
                    return "function" == typeof e && (e = {
                        callback: e
                    }), "undefined" != typeof t && (e.queue = t), h.busy() ? h.pushQueue(e) : h.fireQueueItem(e), h
                }, h.clearQueue = function() {
                    return h.busy.flag = !1, h.queues = [], h
                }, h.stateChanged = !1, h.doubleChecker = !1, h.doubleCheckComplete = function() {
                    return h.stateChanged = !0, h.doubleCheckClear(), h
                }, h.doubleCheckClear = function() {
                    return h.doubleChecker && (s(h.doubleChecker), h.doubleChecker = !1), h
                }, h.doubleCheck = function(e) {
                    return h.stateChanged = !1, h.doubleCheckClear(), h.bugs.ieDoubleCheck && (h.doubleChecker = i(function() {
                        return h.doubleCheckClear(), h.stateChanged || e(), !0
                    }, h.options.doubleCheckInterval)), h
                }, h.safariStatePoll = function() {
                    var t, n = h.extractState(h.getLocationHref());
                    if (!h.isLastSavedState(n)) return t = n, t || (t = h.createStateObject()), h.Adapter.trigger(e, "popstate"), h
                }, h.back = function(e) {
                    return e !== !1 && h.busy() ? (h.pushQueue({
                        scope: h,
                        callback: h.back,
                        args: arguments,
                        queue: e
                    }), !1) : (h.busy(!0), h.doubleCheck(function() {
                        h.back(!1)
                    }), f.go(-1), !0)
                }, h.forward = function(e) {
                    return e !== !1 && h.busy() ? (h.pushQueue({
                        scope: h,
                        callback: h.forward,
                        args: arguments,
                        queue: e
                    }), !1) : (h.busy(!0), h.doubleCheck(function() {
                        h.forward(!1)
                    }), f.go(1), !0)
                }, h.go = function(e, t) {
                    var n;
                    if (e > 0)
                        for (n = 1; n <= e; ++n) h.forward(t);
                    else {
                        if (!(e < 0)) throw new Error("History.go: History.go requires a positive or negative integer passed.");
                        for (n = -1; n >= e; --n) h.back(t)
                    }
                    return h
                }, h.emulated.pushState) {
                var m = function() {};
                h.pushState = h.pushState || m, h.replaceState = h.replaceState || m
            } else h.onPopState = function(t, n) {
                var a, r, o = !1,
                    i = !1;
                return h.doubleCheckComplete(), (a = h.getHash()) ? (r = h.extractState(a || h.getLocationHref(), !0), r ? h.replaceState(r.data, r.title, r.url, !1) : (h.Adapter.trigger(e, "anchorchange"), h.busy(!1)), h.expectedStateId = !1, !1) : (o = h.Adapter.extractEventData("state", t, n) || !1, i = o ? h.getStateById(o) : h.expectedStateId ? h.getStateById(h.expectedStateId) : h.extractState(h.getLocationHref()), i || (i = h.createStateObject(null, null, h.getLocationHref())), h.expectedStateId = !1, h.isLastSavedState(i) ? (h.busy(!1), !1) : (h.storeState(i), h.saveState(i), h.setTitle(i), h.Adapter.trigger(e, "statechange"), h.busy(!1), !0))
            }, h.Adapter.bind(e, "popstate", h.onPopState), h.pushState = function(t, n, a, r) {
                if (h.getHashByUrl(a) && h.emulated.pushState) throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");
                if (r !== !1 && h.busy()) return h.pushQueue({
                    scope: h,
                    callback: h.pushState,
                    args: arguments,
                    queue: r
                }), !1;
                h.busy(!0);
                var o = h.createStateObject(t, n, a);
                return h.isLastSavedState(o) ? h.busy(!1) : (h.storeState(o), h.expectedStateId = o.id, f.pushState(o.id, o.title, o.url), h.Adapter.trigger(e, "popstate")), !0
            }, h.replaceState = function(t, n, a, r) {
                if (h.getHashByUrl(a) && h.emulated.pushState) throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");
                if (r !== !1 && h.busy()) return h.pushQueue({
                    scope: h,
                    callback: h.replaceState,
                    args: arguments,
                    queue: r
                }), !1;
                h.busy(!0);
                var o = h.createStateObject(t, n, a);
                return h.isLastSavedState(o) ? h.busy(!1) : (h.storeState(o), h.expectedStateId = o.id, f.replaceState(o.id, o.title, o.url), h.Adapter.trigger(e, "popstate")), !0
            };
            if (o) {
                try {
                    h.store = c.parse(o.getItem("History.store")) || {}
                } catch (g) {
                    h.store = {}
                }
                h.normalizeStore()
            } else h.store = {}, h.normalizeStore();
            h.Adapter.bind(e, "unload", h.clearAllIntervals), h.saveState(h.storeState(h.extractState(h.getLocationHref(), !0))), o && (h.onUnload = function() {
                var e, t, n;
                try {
                    e = c.parse(o.getItem("History.store")) || {}
                } catch (a) {
                    e = {}
                }
                e.idToState = e.idToState || {}, e.urlToId = e.urlToId || {}, e.stateToId = e.stateToId || {};
                for (t in h.idToState) h.idToState.hasOwnProperty(t) && (e.idToState[t] = h.idToState[t]);
                for (t in h.urlToId) h.urlToId.hasOwnProperty(t) && (e.urlToId[t] = h.urlToId[t]);
                for (t in h.stateToId) h.stateToId.hasOwnProperty(t) && (e.stateToId[t] = h.stateToId[t]);
                h.store = e, h.normalizeStore(), n = c.stringify(e);
                try {
                    o.setItem("History.store", n)
                } catch (r) {
                    if (r.code !== DOMException.QUOTA_EXCEEDED_ERR) throw r;
                    o.length && (o.removeItem("History.store"), o.setItem("History.store", n))
                }
            }, h.intervalList.push(u(h.onUnload, h.options.storeInterval)), h.Adapter.bind(e, "beforeunload", h.onUnload), h.Adapter.bind(e, "unload", h.onUnload)), h.emulated.pushState || (h.bugs.safariPoll && h.intervalList.push(u(h.safariStatePoll, h.options.safariPollInterval)), "Apple Computer, Inc." !== r.vendor && "Mozilla" !== (r.appCodeName || "") || (h.Adapter.bind(e, "hashchange", function() {
                h.Adapter.trigger(e, "popstate")
            }), h.getHash() && h.Adapter.onDomLoad(function() {
                h.Adapter.trigger(e, "hashchange")
            })))
        }, h.options && h.options.delayInit || h.init()
    }(window);
var Guacamole = Guacamole || {};
Guacamole.ArrayBufferReader = function(e) {
    var t = this;
    e.onblob = function(e) {
        for (var n = window.atob(e), a = new ArrayBuffer(n.length), r = new Uint8Array(a), o = 0; o < n.length; o++) r[o] = n.charCodeAt(o);
        t.ondata && t.ondata(a)
    }, e.onend = function() {
        t.onend && t.onend()
    }, this.ondata = null, this.onend = null
};
var Guacamole = Guacamole || {};
Guacamole.ArrayBufferWriter = function(e) {
    function t(t) {
        for (var n = "", a = 0; a < t.byteLength; a++) n += String.fromCharCode(t[a]);
        e.sendBlob(window.btoa(n))
    }
    var n = this;
    e.onack = function(e) {
        n.onack && n.onack(e)
    }, this.sendData = function(e) {
        var n = new Uint8Array(e);
        if (n.length <= 8064) t(n);
        else
            for (var a = 0; a < n.length; a += 8064) t(n.subarray(a, a + 8094))
    }, this.sendEnd = function() {
        e.sendEnd()
    }, this.onack = null
};
var Guacamole = Guacamole || {};
Guacamole.AudioChannel = function() {
    var e = 0;
    this.play = function(t, n, a) {
        var r = new Guacamole.AudioChannel.Packet(t, a),
            o = Guacamole.AudioChannel.getTimestamp();
        e < o && (e = o), r.play(e), e += n
    }
}, window.AudioContext ? Guacamole.AudioChannel.context = new AudioContext : window.webkitAudioContext && (Guacamole.AudioChannel.context = new webkitAudioContext), Guacamole.AudioChannel.getTimestamp = function() {
    if (Guacamole.AudioChannel.context) return 1e3 * Guacamole.AudioChannel.context.currentTime;
    if (window.performance) {
        if (window.performance.now) return window.performance.now();
        if (window.performance.webkitNow) return window.performance.webkitNow()
    }
    return (new Date)
        .getTime()
}, Guacamole.AudioChannel.Packet = function(e, t) {
    function n(e) {
        s.buffer = e, s.start(u / 1e3)
    }

    function a() {
        c.src ? c.play() : l = !0
    }
    if (this.play = function(e) {}, Guacamole.AudioChannel.context) {
        var r = null,
            o = function(e) {
                r = e
            },
            i = new FileReader;
        i.onload = function() {
            Guacamole.AudioChannel.context.decodeAudioData(i.result, function(e) {
                o(e)
            })
        }, i.readAsArrayBuffer(t);
        var s = Guacamole.AudioChannel.context.createBufferSource();
        s.connect(Guacamole.AudioChannel.context.destination), s.start || (s.start = s.noteOn);
        var u;
        this.play = function(e) {
            u = e, r ? n(r) : o = n
        }
    } else {
        var l = !1,
            c = null;
        try {
            c = new Audio
        } catch (d) {}
        if (c) {
            var i = new FileReader;
            i.onload = function() {
                for (var t = "", n = new Uint8Array(i.result), a = 0; a < n.byteLength; a++) t += String.fromCharCode(n[a]);
                c.src = "data:" + e + ";base64," + window.btoa(t), l && c.play()
            }, i.readAsArrayBuffer(t), this.play = function(e) {
                var t = Guacamole.AudioChannel.getTimestamp(),
                    n = e - t;
                n < 0 ? a() : window.setTimeout(a, n)
            }
        }
    }
};
var Guacamole = Guacamole || {};
Guacamole.BlobReader = function(e, t) {
    var n, a = this,
        r = 0;
    n = window.BlobBuilder ? new BlobBuilder : window.WebKitBlobBuilder ? new WebKitBlobBuilder : window.MozBlobBuilder ? new MozBlobBuilder : new function() {
        var e = [];
        this.append = function(n) {
            e.push(new Blob([n], {
                type: t
            }))
        }, this.getBlob = function() {
            return new Blob(e, {
                type: t
            })
        }
    }, e.onblob = function(t) {
        for (var o = window.atob(t), i = new ArrayBuffer(o.length), s = new Uint8Array(i), u = 0; u < o.length; u++) s[u] = o.charCodeAt(u);
        n.append(i), r += i.byteLength, a.onprogress && a.onprogress(i.byteLength), e.sendAck("OK", 0)
    }, e.onend = function() {
        a.onend && a.onend()
    }, this.getLength = function() {
        return r
    }, this.getBlob = function() {
        return n.getBlob()
    }, this.onprogress = null, this.onend = null
};
var Guacamole = Guacamole || {};
Guacamole.Client = function(e) {
    function t(e) {
        e != f && (f = e, i.onstatechange && i.onstatechange(f))
    }

    function n() {
        return f == c || f == l
    }

    function a(e) {
        var t = y[e];
        return t || (t = 0 === e ? v.getDefaultLayer() : e > 0 ? v.createLayer() : v.createBuffer(), y[e] = t), t
    }

    function r(t) {
        var n = S[t];
        return null == n && (n = S[t] = new Guacamole.Parser, n.oninstruction = e.oninstruction), n
    }

    function o(e) {
        var t = b[e];
        return null == t && (t = b[e] = new Guacamole.AudioChannel), t
    }
    var i = this,
        s = 0,
        u = 1,
        l = 2,
        c = 3,
        d = 4,
        h = 5,
        f = s,
        p = null,
        m = {
            0: "butt",
            1: "round",
            2: "square"
        },
        g = {
            0: "bevel",
            1: "miter",
            2: "round"
        },
        v = new Guacamole.Display,
        y = {},
        S = [],
        b = [],
        w = [],
        I = new Guacamole.IntegerPool,
        T = [];
    this.getDisplay = function() {
        return v
    }, this.sendSize = function(t, a) {
        n() && e.sendMessage("size", t, a)
    }, this.sendKeyEvent = function(t, a) {
        n() && e.sendMessage("key", a, t)
    }, this.sendMouseState = function(t) {
        if (n()) {
            v.moveCursor(Math.floor(t.x), Math.floor(t.y));
            var a = 0;
            t.left && (a |= 1), t.middle && (a |= 2), t.right && (a |= 4), t.up && (a |= 8), t.down && (a |= 16), e.sendMessage("mouse", Math.floor(t.x), Math.floor(t.y), a)
        }
    }, this.setClipboard = function(e) {
        if (n()) {
            for (var t = i.createClipboardStream("text/plain"), a = new Guacamole.StringWriter(t), r = 0; r < e.length; r += 4096) a.sendText(e.substring(r, r + 4096));
            a.sendEnd()
        }
    }, this.createFileStream = function(t, n) {
        var a = I.next();
        e.sendMessage("file", a, t, n);
        var r = T[a] = new Guacamole.OutputStream(i, a),
            o = r.sendEnd;
        return r.sendEnd = function() {
            o(), I.free(a), delete T[a]
        }, r
    }, this.createPipeStream = function(t, n) {
        var a = I.next();
        e.sendMessage("pipe", a, t, n);
        var r = T[a] = new Guacamole.OutputStream(i, a),
            o = r.sendEnd;
        return r.sendEnd = function() {
            o(), I.free(a), delete T[a]
        }, r
    }, this.createClipboardStream = function(t) {
        var n = I.next();
        e.sendMessage("clipboard", n, t);
        var a = T[n] = new Guacamole.OutputStream(i, n),
            r = a.sendEnd;
        return a.sendEnd = function() {
            r(), I.free(n), delete T[n]
        }, a
    }, this.sendAck = function(t, a, r) {
        n() && e.sendMessage("ack", t, a, r)
    }, this.sendBlob = function(t, a) {
        n() && e.sendMessage("blob", t, a)
    }, this.endStream = function(t) {
        n() && e.sendMessage("end", t)
    }, this.onstatechange = null, this.onname = null, this.onerror = null, this.onclipboard = null, this.onfile = null, this.onpipe = null, this.onsync = null, this.onturn = null, this.onchat = null, this.onrename = null, this.onadduser = null, this.onremuser = null, this.onconnect = null, this.onlist = null, this.onvote = null, this.onaction = null;
    var k = {
            "miter-limit": function(e, t) {
                v.setMiterLimit(e, parseFloat(t))
            }
        },
        C = {
            turn: function(e) {
                i.onturn && i.onturn(e)
            },
            rename: function(e) {
                i.onrename && i.onrename(e)
            },
            chat: function(e) {
                i.onchat && i.onchat(e)
            },
            adduser: function(e) {
                i.onadduser && i.onadduser(e)
            },
            remuser: function(e) {
                i.onremuser && i.onremuser(e)
            },
            connect: function(e) {
                i.onconnect && i.onconnect(e)
            },
            list: function(e) {
                i.onlist && i.onlist(e)
            },
            vote: function(e) {
                i.onvote && i.onvote(e)
            },
            action: function(e) {
                i.onaction && i.onaction(e)
            },
            file: function(e) {
                i.onfile && i.onfile(e)
            },
            nop: function() {
                e.sendMessage("nop")
            },
            ack: function(e) {
                var t = parseInt(e[0]),
                    n = e[1],
                    a = parseInt(e[2]),
                    r = T[t];
                r && (r.onack && r.onack(new Guacamole.Status(a, n)), a >= 256 && (I.free(t), delete T[t]))
            },
            arc: function(e) {
                var t = a(parseInt(e[0])),
                    n = parseInt(e[1]),
                    r = parseInt(e[2]),
                    o = parseInt(e[3]),
                    i = parseFloat(e[4]),
                    s = parseFloat(e[5]),
                    u = parseInt(e[6]);
                v.arc(t, n, r, o, i, s, 0 != u)
            },
            audio: function(e) {
                var t = parseInt(e[0]),
                    n = o(parseInt(e[1])),
                    a = e[2],
                    r = parseFloat(e[3]),
                    s = w[t] = new Guacamole.InputStream(i, t),
                    u = new Guacamole.BlobReader(s, a);
                u.onend = function() {
                    n.play(a, r, u.getBlob())
                }, i.sendAck(t, "OK", 0)
            },
            blob: function(e) {
                var t = parseInt(e[0]),
                    n = e[1],
                    a = w[t];
                a.onblob(n)
            },
            cfill: function(e) {
                var t = parseInt(e[0]),
                    n = a(parseInt(e[1])),
                    r = parseInt(e[2]),
                    o = parseInt(e[3]),
                    i = parseInt(e[4]),
                    s = parseInt(e[5]);
                v.setChannelMask(n, t), v.fillColor(n, r, o, i, s)
            },
            clip: function(e) {
                var t = a(parseInt(e[0]));
                v.clip(t)
            },
            clipboard: function(e) {
                var t = parseInt(e[0]),
                    n = e[1];
                if (i.onclipboard) {
                    var a = w[t] = new Guacamole.InputStream(i, t);
                    i.onclipboard(a, n)
                } else i.sendAck(t, "Clipboard unsupported", 256)
            },
            close: function(e) {
                var t = a(parseInt(e[0]));
                v.close(t)
            },
            copy: function(e) {
                var t = a(parseInt(e[0])),
                    n = parseInt(e[1]),
                    r = parseInt(e[2]),
                    o = parseInt(e[3]),
                    i = parseInt(e[4]),
                    s = parseInt(e[5]),
                    u = a(parseInt(e[6])),
                    l = parseInt(e[7]),
                    c = parseInt(e[8]);
                v.setChannelMask(u, s), v.copy(t, n, r, o, i, u, l, c)
            },
            cstroke: function(e) {
                var t = parseInt(e[0]),
                    n = a(parseInt(e[1])),
                    r = m[parseInt(e[2])],
                    o = g[parseInt(e[3])],
                    i = parseInt(e[4]),
                    s = parseInt(e[5]),
                    u = parseInt(e[6]),
                    l = parseInt(e[7]),
                    c = parseInt(e[8]);
                v.setChannelMask(n, t), v.strokeColor(n, r, o, i, s, u, l, c)
            },
            cursor: function(e) {
                var t = parseInt(e[0]),
                    n = parseInt(e[1]),
                    r = a(parseInt(e[2])),
                    o = parseInt(e[3]),
                    i = parseInt(e[4]),
                    s = parseInt(e[5]),
                    u = parseInt(e[6]);
                v.setCursor(t, n, r, o, i, s, u)
            },
            curve: function(e) {
                var t = a(parseInt(e[0])),
                    n = parseInt(e[1]),
                    r = parseInt(e[2]),
                    o = parseInt(e[3]),
                    i = parseInt(e[4]),
                    s = parseInt(e[5]),
                    u = parseInt(e[6]);
                v.curveTo(t, n, r, o, i, s, u)
            },
            dispose: function(e) {
                var t = parseInt(e[0]);
                if (t > 0) {
                    var n = a(t);
                    n.dispose(), delete y[t]
                } else t < 0 && delete y[t]
            },
            distort: function(e) {
                var t = parseInt(e[0]),
                    n = parseFloat(e[1]),
                    r = parseFloat(e[2]),
                    o = parseFloat(e[3]),
                    i = parseFloat(e[4]),
                    s = parseFloat(e[5]),
                    u = parseFloat(e[6]);
                if (t >= 0) {
                    var l = a(t);
                    l.distort(n, r, o, i, s, u)
                }
            },
            error: function(e) {
                var t = e[0],
                    n = parseInt(e[1]);
                i.onerror && i.onerror(new Guacamole.Status(n, t)), i.disconnect()
            },
            end: function(e) {
                var t = parseInt(e[0]),
                    n = w[t];
                n.onend && n.onend()
            },
            identity: function(e) {
                var t = a(parseInt(e[0]));
                v.setTransform(t, 1, 0, 0, 1, 0, 0)
            },
            lfill: function(e) {
                var t = parseInt(e[0]),
                    n = a(parseInt(e[1])),
                    r = a(parseInt(e[2]));
                v.setChannelMask(n, t), v.fillLayer(n, r)
            },
            line: function(e) {
                var t = a(parseInt(e[0])),
                    n = parseInt(e[1]),
                    r = parseInt(e[2]);
                v.lineTo(t, n, r)
            },
            lstroke: function(e) {
                var t = parseInt(e[0]),
                    n = a(parseInt(e[1])),
                    r = a(parseInt(e[2]));
                v.setChannelMask(n, t), v.strokeLayer(n, r)
            },
            move: function(e) {
                var t = parseInt(e[0]),
                    n = parseInt(e[1]),
                    r = parseInt(e[2]),
                    o = parseInt(e[3]),
                    i = parseInt(e[4]);
                if (t > 0 && n >= 0) {
                    var s = a(t),
                        u = a(n);
                    s.move(u, r, o, i)
                }
            },
            name: function(e) {
                i.onname && i.onname(e[0])
            },
            nest: function(e) {
                var t = r(parseInt(e[0]));
                t.receive(e[1])
            },
            pipe: function(e) {
                var t = parseInt(e[0]),
                    n = e[1],
                    a = e[2];
                if (i.onpipe) {
                    var r = w[t] = new Guacamole.InputStream(i, t);
                    i.onpipe(r, n, a)
                } else i.sendAck(t, "Named pipes unsupported", 256)
            },
            png: function(e) {
                var t = parseInt(e[0]),
                    n = a(parseInt(e[1])),
                    r = parseInt(e[2]),
                    o = parseInt(e[3]),
                    i = e[4];
                v.setChannelMask(n, t), v.draw(n, r, o, "data:image/png;base64," + i)
            },
            pop: function(e) {
                var t = a(parseInt(e[0]));
                v.pop(t)
            },
            push: function(e) {
                var t = a(parseInt(e[0]));
                v.push(t)
            },
            rect: function(e) {
                var t = a(parseInt(e[0])),
                    n = parseInt(e[1]),
                    r = parseInt(e[2]),
                    o = parseInt(e[3]),
                    i = parseInt(e[4]);
                v.rect(t, n, r, o, i)
            },
            reset: function(e) {
                var t = a(parseInt(e[0]));
                v.reset(t)
            },
            set: function(e) {
                var t = a(parseInt(e[0])),
                    n = e[1],
                    r = e[2],
                    o = k[n];
                o && o(t, r)
            },
            shade: function(e) {
                var t = parseInt(e[0]),
                    n = parseInt(e[1]);
                if (t >= 0) {
                    var r = a(t);
                    r.shade(n)
                }
            },
            size: function(e) {
                var t = parseInt(e[0]),
                    n = a(t),
                    r = parseInt(e[1]),
                    o = parseInt(e[2]);
                v.resize(n, r, o)
            },
            start: function(e) {
                var t = a(parseInt(e[0])),
                    n = parseInt(e[1]),
                    r = parseInt(e[2]);
                v.moveTo(t, n, r)
            },
            sync: function(e) {
                var t = parseInt(e[0]);
                v.flush(null), i.onsync && i.onsync(t)
            },
            transfer: function(e) {
                var t = a(parseInt(e[0])),
                    n = parseInt(e[1]),
                    r = parseInt(e[2]),
                    o = parseInt(e[3]),
                    i = parseInt(e[4]),
                    s = parseInt(e[5]),
                    u = a(parseInt(e[6])),
                    l = parseInt(e[7]),
                    c = parseInt(e[8]);
                3 === s ? v.put(t, n, r, o, i, u, l, c) : 5 !== s && v.transfer(t, n, r, o, i, u, l, c, Guacamole.Client.DefaultTransferFunction[s])
            },
            transform: function(e) {
                var t = a(parseInt(e[0])),
                    n = parseFloat(e[1]),
                    r = parseFloat(e[2]),
                    o = parseFloat(e[3]),
                    i = parseFloat(e[4]),
                    s = parseFloat(e[5]),
                    u = parseFloat(e[6]);
                v.transform(t, n, r, o, i, s, u)
            },
            video: function(t) {
                var n = parseInt(t[0]),
                    r = a(parseInt(t[1])),
                    o = t[2],
                    s = parseFloat(t[3]),
                    u = w[n] = new Guacamole.InputStream(i, n),
                    l = new Guacamole.BlobReader(u, o);
                l.onend = function() {
                    var e = new FileReader;
                    e.onload = function() {
                        for (var t = "", n = new Uint8Array(e.result), a = 0; a < n.byteLength; a++) t += String.fromCharCode(n[a]);
                        r.play(o, s, "data:" + o + ";base64," + window.btoa(t))
                    }, e.readAsArrayBuffer(l.getBlob())
                }, e.sendMessage("ack", n, "OK", 0)
            }
        };
    e.oninstruction = function(e, t) {
        var n = C[e];
        n && n(t)
    }, this.disconnect = function() {
        f != h && f != d && (t(d), p && window.clearInterval(p), e.sendMessage("disconnect"), e.disconnect(), t(h))
    }, this.connect = function(n) {
        t(u);
        try {
            e.connect(n)
        } catch (a) {
            throw t(s), a
        }
        t(l)
    }
}, Guacamole.Client.DefaultTransferFunction = {
    0: function(e, t) {
        t.red = t.green = t.blue = 0
    },
    15: function(e, t) {
        t.red = t.green = t.blue = 255
    },
    3: function(e, t) {
        t.red = e.red, t.green = e.green, t.blue = e.blue, t.alpha = e.alpha
    },
    5: function(e, t) {},
    12: function(e, t) {
        t.red = 255 & ~e.red, t.green = 255 & ~e.green, t.blue = 255 & ~e.blue, t.alpha = e.alpha
    },
    10: function(e, t) {
        t.red = 255 & ~t.red, t.green = 255 & ~t.green, t.blue = 255 & ~t.blue
    },
    1: function(e, t) {
        t.red = e.red & t.red, t.green = e.green & t.green, t.blue = e.blue & t.blue
    },
    14: function(e, t) {
        t.red = 255 & ~(e.red & t.red), t.green = 255 & ~(e.green & t.green), t.blue = 255 & ~(e.blue & t.blue)
    },
    7: function(e, t) {
        t.red = e.red | t.red, t.green = e.green | t.green, t.blue = e.blue | t.blue
    },
    8: function(e, t) {
        t.red = 255 & ~(e.red | t.red), t.green = 255 & ~(e.green | t.green), t.blue = 255 & ~(e.blue | t.blue)
    },
    6: function(e, t) {
        t.red = e.red ^ t.red, t.green = e.green ^ t.green, t.blue = e.blue ^ t.blue
    },
    9: function(e, t) {
        t.red = 255 & ~(e.red ^ t.red), t.green = 255 & ~(e.green ^ t.green), t.blue = 255 & ~(e.blue ^ t.blue)
    },
    4: function(e, t) {
        t.red = 255 & (~e.red & t.red), t.green = 255 & (~e.green & t.green), t.blue = 255 & (~e.blue & t.blue)
    },
    13: function(e, t) {
        t.red = 255 & (~e.red | t.red), t.green = 255 & (~e.green | t.green), t.blue = 255 & (~e.blue | t.blue)
    },
    2: function(e, t) {
        t.red = 255 & (e.red & ~t.red), t.green = 255 & (e.green & ~t.green), t.blue = 255 & (e.blue & ~t.blue)
    },
    11: function(e, t) {
        t.red = 255 & (e.red | ~t.red), t.green = 255 & (e.green | ~t.green), t.blue = 255 & (e.blue | ~t.blue)
    }
};
var Guacamole = Guacamole || {};
Guacamole.Display = function() {
    function e() {
        for (var e = 0; e < f.length;) {
            var t = f[e];
            if (!t.isReady()) break;
            t.flush(), e++
        }
        f.splice(0, e)
    }

    function t(e, t) {
        this.isReady = function() {
            for (var e = 0; e < t.length; e++)
                if (t[e].blocked) return !1;
            return !0
        }, this.flush = function() {
            for (var n = 0; n < t.length; n++) t[n].execute();
            e && e()
        }
    }

    function n(t, n) {
        var a = this;
        this.blocked = n, this.unblock = function() {
            a.blocked && (a.blocked = !1, e())
        }, this.execute = function() {
            t && t()
        }
    }

    function a(e, t) {
        var a = new n(e, t);
        return h.push(a), a
    }
    var r = this,
        o = 0,
        i = 0,
        s = 1,
        u = document.createElement("div");
    u.style.position = "relative", u.style.width = o + "px", u.style.height = i + "px", u.style.transformOrigin = u.style.webkitTransformOrigin = u.style.MozTransformOrigin = u.style.OTransformOrigin = u.style.msTransformOrigin = "0 0";
    var l = new Guacamole.Display.VisibleLayer(o, i),
        c = new Guacamole.Display.VisibleLayer(0, 0);
    c.setChannelMask(Guacamole.Layer.SRC), u.appendChild(l.getElement()), u.appendChild(c.getElement());
    var d = document.createElement("div");
    d.style.position = "relative", d.style.width = o * s + "px", d.style.height = i * s + "px", d.appendChild(u), this.cursorHotspotX = 0, this.cursorHotspotY = 0, this.cursorX = 0, this.cursorY = 0, this.onresize = null, this.oncursor = null;
    var h = [],
        f = [];
    this.getElement = function() {
        return d
    }, this.getWidth = function() {
        return o
    }, this.getHeight = function() {
        return i
    }, this.getDefaultLayer = function() {
        return l
    }, this.getCursorLayer = function() {
        return c
    }, this.createLayer = function() {
        var e = new Guacamole.Display.VisibleLayer(o, i);
        return e.move(l, 0, 0, 0), e
    }, this.createBuffer = function() {
        var e = new Guacamole.Layer(0, 0);
        return e.autosize = 1, e
    }, this.flush = function(n) {
        f.push(new t(n, h)), h = [], e()
    }, this.setCursor = function(e, t, n, o, i, s, u) {
        a(function() {
            r.cursorHotspotX = e, r.cursorHotspotY = t, c.resize(s, u), c.copy(n, o, i, s, u, 0, 0), r.moveCursor(r.cursorX, r.cursorY), r.oncursor && r.oncursor(c.getCanvas(), e, t)
        })
    }, this.showCursor = function(e) {
        var t = c.getElement(),
            n = t.parentNode;
        e === !1 ? n && n.removeChild(t) : n !== u && u.appendChild(t)
    }, this.moveCursor = function(e, t) {
        c.translate(e - r.cursorHotspotX, t - r.cursorHotspotY), r.cursorX = e, r.cursorY = t
    }, this.resize = function(e, t, n) {
        a(function() {
            e.resize(t, n), e === l && (o = t, i = n, u.style.width = o + "px", u.style.height = i + "px", d.style.width = o * s + "px", d.style.height = i * s + "px", r.onresize && r.onresize(t, n))
        })
    }, this.drawImage = function(e, t, n, r) {
        a(function() {
            e.drawImage(t, n, r)
        })
    }, this.draw = function(e, t, n, r) {
        var o = a(function() {
                e.drawImage(t, n, i)
            }, !0),
            i = new Image;
        i.onload = o.unblock, i.src = r
    }, this.play = function(e, t, n, r) {
        var o = document.createElement("video");
        o.type = t, o.src = r, o.addEventListener("play", function() {
            function t() {
                e.drawImage(0, 0, o), o.ended || window.setTimeout(t, 20)
            }
            t()
        }, !1), a(o.play)
    }, this.transfer = function(e, t, n, r, o, i, s, u, l) {
        a(function() {
            i.transfer(e, t, n, r, o, s, u, l)
        })
    }, this.put = function(e, t, n, r, o, i, s, u) {
        a(function() {
            i.put(e, t, n, r, o, s, u)
        })
    }, this.copy = function(e, t, n, r, o, i, s, u) {
        a(function() {
            i.copy(e, t, n, r, o, s, u)
        })
    }, this.moveTo = function(e, t, n) {
        a(function() {
            e.moveTo(t, n)
        })
    }, this.lineTo = function(e, t, n) {
        a(function() {
            e.lineTo(t, n)
        })
    }, this.arc = function(e, t, n, r, o, i, s) {
        a(function() {
            e.arc(t, n, r, o, i, s)
        })
    }, this.curveTo = function(e, t, n, r, o, i, s) {
        a(function() {
            e.curveTo(t, n, r, o, i, s)
        })
    }, this.close = function(e) {
        a(function() {
            e.close()
        })
    }, this.rect = function(e, t, n, r, o) {
        a(function() {
            e.rect(t, n, r, o)
        })
    }, this.clip = function(e) {
        a(function() {
            e.clip()
        })
    }, this.strokeColor = function(e, t, n, r, o, i, s, u) {
        a(function() {
            e.strokeColor(t, n, r, o, i, s, u)
        })
    }, this.fillColor = function(e, t, n, r, o) {
        a(function() {
            e.fillColor(t, n, r, o)
        })
    }, this.strokeLayer = function(e, t, n, r, o) {
        a(function() {
            e.strokeLayer(t, n, r, o)
        })
    }, this.fillLayer = function(e, t) {
        a(function() {
            e.fillLayer(t)
        })
    }, this.push = function(e) {
        a(function() {
            e.push()
        })
    }, this.pop = function(e) {
        a(function() {
            e.pop()
        })
    }, this.reset = function(e) {
        a(function() {
            e.reset()
        })
    }, this.setTransform = function(e, t, n, r, o, i, s) {
        a(function() {
            e.setTransform(t, n, r, o, i, s)
        })
    }, this.transform = function(e, t, n, r, o, i, s) {
        a(function() {
            e.transform(t, n, r, o, i, s)
        })
    }, this.setChannelMask = function(e, t) {
        a(function() {
            e.setChannelMask(t)
        })
    }, this.setMiterLimit = function(e, t) {
        a(function() {
            e.setMiterLimit(t)
        })
    }, this.scale = function(e) {
        u.style.transform = u.style.WebkitTransform = u.style.MozTransform = u.style.OTransform = u.style.msTransform = "scale(" + e + "," + e + ")", s = e, d.style.width = o * s + "px", d.style.height = i * s + "px"
    }, this.getScale = function() {
        return s
    }, this.flatten = function() {
        function e(e) {
            var t = [];
            for (var n in e.children) t.push(e.children[n]);
            return t.sort(function(e, t) {
                var n = e.z - t.z;
                if (0 !== n) return n;
                var a = e.getElement(),
                    r = t.getElement(),
                    o = r.compareDocumentPosition(a);
                return o & Node.DOCUMENT_POSITION_PRECEDING ? -1 : o & Node.DOCUMENT_POSITION_FOLLOWING ? 1 : 0
            }), t
        }

        function t(n, r, o) {
            if (n.width > 0 && n.height > 0) {
                var i = a.globalAlpha;
                a.globalAlpha *= n.alpha / 255, a.drawImage(n.getCanvas(), r, o);
                for (var s = e(n), u = 0; u < s.length; u++) {
                    var l = s[u];
                    t(l, r + l.x, o + l.y)
                }
                a.globalAlpha = i
            }
        }
        var n = document.createElement("canvas");
        n.width = l.width, n.height = l.height;
        var a = n.getContext("2d");
        return t(l, 0, 0), n
    }
}, Guacamole.Display.VisibleLayer = function(e, t) {
    Guacamole.Layer.apply(this, [e, t]);
    var n = this;
    this.__unique_id = Guacamole.Display.VisibleLayer.__next_id++, this.alpha = 255, this.x = 0, this.y = 0, this.z = 0, this.matrix = [1, 0, 0, 1, 0, 0], this.parent = null, this.children = {};
    var a = n.getCanvas();
    a.style.position = "absolute", a.style.left = "0px", a.style.top = "0px";
    var r = document.createElement("div");
    r.appendChild(a), r.style.width = e + "px", r.style.height = t + "px", r.style.position = "absolute", r.style.left = "0px", r.style.top = "0px", r.style.overflow = "hidden";
    var o = this.resize;
    this.resize = function(e, t) {
        r.style.width = e + "px", r.style.height = t + "px", o(e, t)
    }, this.getElement = function() {
        return r
    };
    var i = "translate(0px, 0px)",
        s = "matrix(1, 0, 0, 1, 0, 0)";
    this.translate = function(e, t) {
        n.x = e, n.y = t, i = "translate(" + e + "px," + t + "px)", r.style.transform = r.style.WebkitTransform = r.style.MozTransform = r.style.OTransform = r.style.msTransform = i + " " + s
    }, this.move = function(e, t, a, o) {
        if (n.parent !== e) {
            n.parent && delete n.parent.children[n.__unique_id], n.parent = e, e.children[n.__unique_id] = n;
            var i = e.getElement();
            i.appendChild(r)
        }
        n.translate(t, a), n.z = o, r.style.zIndex = o
    }, this.shade = function(e) {
        n.alpha = e, r.style.opacity = e / 255
    }, this.dispose = function() {
        n.parent && (delete n.parent.children[n.__unique_id], n.parent = null), r.parentNode && r.parentNode.removeChild(r)
    }, this.distort = function(e, t, a, o, u, l) {
        n.matrix = [e, t, a, o, u, l], s = "matrix(" + e + "," + t + "," + a + "," + o + "," + u + "," + l + ")", r.style.transform = r.style.WebkitTransform = r.style.MozTransform = r.style.OTransform = r.style.msTransform = i + " " + s
    }
}, Guacamole.Display.VisibleLayer.__next_id = 0;
var Guacamole = Guacamole || {};
Guacamole.InputStream = function(e, t) {
    var n = this;
    this.index = t, this.onblob = null, this.onend = null, this.sendAck = function(t, a) {
        e.sendAck(n.index, t, a)
    }
};
var Guacamole = Guacamole || {};
Guacamole.IntegerPool = function() {
    var e = this,
        t = [];
    this.next_int = 0, this.next = function() {
        return t.length > 0 ? t.shift() : e.next_int++
    }, this.free = function(e) {
        t.push(e)
    }
};
var Guacamole = Guacamole || {};
Guacamole.Keyboard = function(e) {
    function t(e, t) {
        return e ? e[t] || e[0] : null
    }

    function n(e, n, a) {
        if (!e) return null;
        var o, i = e.indexOf("U+");
        if (i >= 0) {
            var s = e.substring(i + 2);
            o = String.fromCharCode(parseInt(s, 16))
        } else {
            if (1 !== e.length) return t(y[e], n);
            o = e
        }
        a === !0 ? o = o.toUpperCase() : a === !1 && (o = o.toLowerCase());
        var u = o.charCodeAt(0);
        return r(u)
    }

    function a(e) {
        return e <= 31 || e >= 127 && e <= 159
    }

    function r(e) {
        return a(e) ? 65280 | e : e >= 0 && e <= 255 ? e : e >= 256 && e <= 1114111 ? 16777216 | e : null
    }

    function o(e, n) {
        return t(v[e], n)
    }

    function i(e, t) {
        if (!t) return !1;
        var n = t.indexOf("U+");
        if (n === -1) return !0;
        var a = parseInt(t.substring(n + 2), 16);
        return e !== a || (e >= 65 && e <= 90 || e >= 48 && e <= 57)
    }

    function s(e) {
        var t = Guacamole.Keyboard.ModifierState.fromKeyboardEvent(e);
        d.modifiers.alt && t.alt === !1 && (d.release(65513), d.release(65514), d.release(65027)), d.modifiers.shift && t.shift === !1 && (d.release(65505), d.release(65506)), d.modifiers.ctrl && t.ctrl === !1 && (d.release(65507), d.release(65508)), d.modifiers.meta && t.meta === !1 && (d.release(65511), d.release(65512)), d.modifiers.hyper && t.hyper === !1 && (d.release(65515), d.release(65516)), d.modifiers = t
    }

    function u() {
        var e = c();
        if (!e) return !1;
        var t;
        do t = e, e = c(); while (null !== e);
        return t.defaultPrevented
    }

    function l(e) {
        d.modifiers.ctrl && d.modifiers.alt && (e >= 65 && e <= 90 || e >= 97 && e <= 122 || (e <= 255 || 16777216 === (4278190080 & e)) && (d.release(65507), d.release(65508), d.release(65513), d.release(65514)))
    }

    function c() {
        var e = g[0];
        if (!e) return null;
        if (!(e instanceof f)) {
            if (e instanceof m) {
                var t = e.keysym;
                return t ? (d.release(t), e.defaultPrevented = !0) : d.reset(), g.shift()
            }
            return g.shift()
        }
        var t = null,
            n = [];
        if (e.reliable ? (t = e.keysym, n = g.splice(0, 1)) : g[1] instanceof p ? (t = g[1].keysym, n = g.splice(0, 2)) : g[1] && (t = e.keysym, n = g.splice(0, 1)), n.length > 0) {
            if (t) {
                l(t);
                var a = !d.press(t);
                w[e.keyCode] = t, d.modifiers.meta && 65511 !== t && 65512 !== t && d.release(t);
                for (var r = 0; r < n.length; r++) n[r].defaultPrevented = a
            }
            return e
        }
        return null
    }
    var d = this;
    this.onkeydown = null, this.onkeyup = null;
    var h = function() {
            var e = this;
            this.timestamp = (new Date)
                .getTime(), this.defaultPrevented = !1, this.keysym = null, this.reliable = !1, this.getAge = function() {
                    return (new Date)
                        .getTime() - e.timestamp
                }
        },
        f = function(e, t, a, r) {
            h.apply(this), this.keyCode = e, this.keyIdentifier = t, this.key = a, this.location = r, this.keysym = n(a, r) || o(e, r), this.keysym && (this.reliable = !0), !this.keysym && i(e, t) && (this.keysym = n(t, r, d.modifiers.shift));
            var s = !(d.modifiers.ctrl || navigator && navigator.platform && navigator.platform.match(/^mac/i)),
                u = !d.modifiers.alt;
            (u && d.modifiers.ctrl || s && d.modifiers.alt || d.modifiers.meta || d.modifiers.hyper) && (this.reliable = !0), w[e] = this.keysym
        };
    f.prototype = new h;
    var p = function(e) {
        h.apply(this), this.charCode = e, this.keysym = r(e), this.reliable = !0
    };
    p.prototype = new h;
    var m = function(e, t, a, r) {
        h.apply(this), this.keyCode = e, this.keyIdentifier = t, this.key = a, this.location = r, this.keysym = w[e] || o(e, r) || n(a, r), this.reliable = !0
    };
    m.prototype = new h;
    var g = [],
        v = {
            8: [65288],
            9: [65289],
            13: [65293],
            16: [65505, 65505, 65506],
            17: [65507, 65507, 65508],
            18: [65513, 65513, 65027],
            19: [65299],
            20: [65509],
            27: [65307],
            32: [32],
            33: [65365],
            34: [65366],
            35: [65367],
            36: [65360],
            37: [65361],
            38: [65362],
            39: [65363],
            40: [65364],
            45: [65379],
            46: [65535],
            91: [65515],
            92: [65383],
            93: null,
            112: [65470],
            113: [65471],
            114: [65472],
            115: [65473],
            116: [65474],
            117: [65475],
            118: [65476],
            119: [65477],
            120: [65478],
            121: [65479],
            122: [65480],
            123: [65481],
            144: [65407],
            145: [65300],
            225: [65027]
        },
        y = {
            Again: [65382],
            AllCandidates: [65341],
            Alphanumeric: [65328],
            Alt: [65513, 65513, 65027],
            Attn: [64782],
            AltGraph: [65027],
            ArrowDown: [65364],
            ArrowLeft: [65361],
            ArrowRight: [65363],
            ArrowUp: [65362],
            Backspace: [65288],
            CapsLock: [65509],
            Cancel: [65385],
            Clear: [65291],
            Convert: [65313],
            Copy: [64789],
            Crsel: [64796],
            CrSel: [64796],
            CodeInput: [65335],
            Compose: [65312],
            Control: [65507, 65507, 65508],
            ContextMenu: [65383],
            DeadGrave: [65104],
            DeadAcute: [65105],
            DeadCircumflex: [65106],
            DeadTilde: [65107],
            DeadMacron: [65108],
            DeadBreve: [65109],
            DeadAboveDot: [65110],
            DeadUmlaut: [65111],
            DeadAboveRing: [65112],
            DeadDoubleacute: [65113],
            DeadCaron: [65114],
            DeadCedilla: [65115],
            DeadOgonek: [65116],
            DeadIota: [65117],
            DeadVoicedSound: [65118],
            DeadSemivoicedSound: [65119],
            Delete: [65535],
            Down: [65364],
            End: [65367],
            Enter: [65293],
            EraseEof: [64774],
            Escape: [65307],
            Execute: [65378],
            Exsel: [64797],
            ExSel: [64797],
            F1: [65470],
            F2: [65471],
            F3: [65472],
            F4: [65473],
            F5: [65474],
            F6: [65475],
            F7: [65476],
            F8: [65477],
            F9: [65478],
            F10: [65479],
            F11: [65480],
            F12: [65481],
            F13: [65482],
            F14: [65483],
            F15: [65484],
            F16: [65485],
            F17: [65486],
            F18: [65487],
            F19: [65488],
            F20: [65489],
            F21: [65490],
            F22: [65491],
            F23: [65492],
            F24: [65493],
            Find: [65384],
            GroupFirst: [65036],
            GroupLast: [65038],
            GroupNext: [65032],
            GroupPrevious: [65034],
            FullWidth: null,
            HalfWidth: null,
            HangulMode: [65329],
            Hankaku: [65321],
            HanjaMode: [65332],
            Help: [65386],
            Hiragana: [65317],
            HiraganaKatakana: [65319],
            Home: [65360],
            Hyper: [65517, 65517, 65518],
            Insert: [65379],
            JapaneseHiragana: [65317],
            JapaneseKatakana: [65318],
            JapaneseRomaji: [65316],
            JunjaMode: [65336],
            KanaMode: [65325],
            KanjiMode: [65313],
            Katakana: [65318],
            Left: [65361],
            Meta: [65511, 65511, 65512],
            ModeChange: [65406],
            NumLock: [65407],
            PageDown: [65366],
            PageUp: [65365],
            Pause: [65299],
            Play: [64790],
            PreviousCandidate: [65342],
            PrintScreen: [64797],
            Redo: [65382],
            Right: [65363],
            RomanCharacters: null,
            Scroll: [65300],
            Select: [65376],
            Separator: [65452],
            Shift: [65505, 65505, 65506],
            SingleCandidate: [65340],
            Super: [65515, 65515, 65516],
            Tab: [65289],
            Up: [65362],
            Undo: [65381],
            Win: [65515],
            Zenkaku: [65320],
            ZenkakuHankaku: [65322]
        },
        S = {
            65027: !0,
            65505: !0,
            65506: !0,
            65507: !0,
            65508: !0,
            65511: !0,
            65512: !0,
            65513: !0,
            65514: !0,
            65515: !0,
            65516: !0
        };
    this.modifiers = new Guacamole.Keyboard.ModifierState, this.pressed = {};
    var b = {},
        w = {},
        I = null,
        T = null;
    this.press = function(e) {
        if (null !== e) {
            if (!d.pressed[e] && (d.pressed[e] = !0, d.onkeydown)) {
                var t = d.onkeydown(e);
                return b[e] = t, window.clearTimeout(I), window.clearInterval(T), S[e] || (I = window.setTimeout(function() {
                    T = window.setInterval(function() {
                        d.onkeyup(e), d.onkeydown(e)
                    }, 50)
                }, 500)), t
            }
            return b[e] || !1
        }
    }, this.release = function(e) {
        d.pressed[e] && (delete d.pressed[e], window.clearTimeout(I), window.clearInterval(T), null !== e && d.onkeyup && d.onkeyup(e))
    }, this.reset = function() {
        for (var e in d.pressed) d.release(parseInt(e));
        g = []
    };
    var k = function(e) {
        return "location" in e ? e.location : "keyLocation" in e ? e.keyLocation : 0
    };
    e.addEventListener("keydown", function(e) {
        if (d.onkeydown) {
            var t;
            if (window.event ? t = window.event.keyCode : e.which && (t = e.which), s(e), 229 !== t) {
                var n = new f(t, e.keyIdentifier, e.key, k(e));
                g.push(n), u() && e.preventDefault()
            }
        }
    }, !0), e.addEventListener("keypress", function(e) {
        if (d.onkeydown || d.onkeyup) {
            var t;
            window.event ? t = window.event.keyCode : e.which && (t = e.which), s(e);
            var n = new p(t);
            g.push(n), u() && e.preventDefault()
        }
    }, !0), e.addEventListener("keyup", function(e) {
        if (d.onkeyup) {
            e.preventDefault();
            var t;
            window.event ? t = window.event.keyCode : e.which && (t = e.which), s(e);
            var n = new m(t, e.keyIdentifier, e.key, k(e));
            g.push(n), u()
        }
    }, !0)
}, Guacamole.Keyboard.ModifierState = function() {
    this.shift = !1, this.ctrl = !1, this.alt = !1, this.meta = !1, this.hyper = !1
}, Guacamole.Keyboard.ModifierState.fromKeyboardEvent = function(e) {
    var t = new Guacamole.Keyboard.ModifierState;
    return t.shift = e.shiftKey, t.ctrl = e.ctrlKey, t.alt = e.altKey, t.meta = e.metaKey, e.getModifierState && (t.hyper = e.getModifierState("OS") || e.getModifierState("Super") || e.getModifierState("Hyper") || e.getModifierState("Win")), t
};
var Guacamole = Guacamole || {};
Guacamole.Layer = function(e, t) {
    function n(e, t) {
        var n = null;
        if (0 !== r.width && 0 !== r.height) {
            n = document.createElement("canvas"), n.width = r.width, n.height = r.height;
            var a = n.getContext("2d");
            a.drawImage(o, 0, 0, r.width, r.height, 0, 0, r.width, r.height)
        }
        var s = i.globalCompositeOperation;
        o.width = e, o.height = t, n && i.drawImage(n, 0, 0, r.width, r.height, 0, 0, r.width, r.height), i.globalCompositeOperation = s, r.width = e, r.height = t, u = 0, i.save()
    }

    function a(e, t, n, a) {
        var o, i = n + e,
            s = a + t;
        o = i > r.width ? i : r.width;
        var u;
        u = s > r.height ? s : r.height, r.resize(o, u)
    }
    var r = this,
        o = document.createElement("canvas"),
        i = o.getContext("2d");
    i.save();
    var s = !0,
        u = 0,
        l = {
            1: "destination-in",
            2: "destination-out",
            4: "source-in",
            6: "source-atop",
            8: "source-out",
            9: "destination-atop",
            10: "xor",
            11: "destination-over",
            12: "copy",
            14: "source-over",
            15: "lighter"
        };
    this.autosize = !1, this.width = e, this.height = t, this.getCanvas = function() {
        return o
    }, this.resize = function(e, t) {
        e === r.width && t === r.height || n(e, t)
    }, this.drawImage = function(e, t, n) {
        r.autosize && a(e, t, n.width, n.height), i.drawImage(n, e, t)
    }, this.transfer = function(e, t, n, o, s, u, l, c) {
        var d = e.getCanvas();
        if (!(t >= d.width || n >= d.height) && (t + o > d.width && (o = d.width - t), n + s > d.height && (s = d.height - n), 0 !== o && 0 !== s)) {
            r.autosize && a(u, l, o, s);
            for (var h = e.getCanvas()
                    .getContext("2d")
                    .getImageData(t, n, o, s), f = i.getImageData(u, l, o, s), p = 0; p < o * s * 4; p += 4) {
                var m = new Guacamole.Layer.Pixel(h.data[p], h.data[p + 1], h.data[p + 2], h.data[p + 3]),
                    g = new Guacamole.Layer.Pixel(f.data[p], f.data[p + 1], f.data[p + 2], f.data[p + 3]);
                c(m, g), f.data[p] = g.red, f.data[p + 1] = g.green, f.data[p + 2] = g.blue, f.data[p + 3] = g.alpha
            }
            i.putImageData(f, u, l)
        }
    }, this.put = function(e, t, n, o, s, u, l) {
        var c = e.getCanvas();
        if (!(t >= c.width || n >= c.height) && (t + o > c.width && (o = c.width - t), n + s > c.height && (s = c.height - n), 0 !== o && 0 !== s)) {
            r.autosize && a(u, l, o, s);
            var d = e.getCanvas()
                .getContext("2d")
                .getImageData(t, n, o, s);
            i.putImageData(d, u, l)
        }
    }, this.copy = function(e, t, n, o, s, u, l) {
        var c = e.getCanvas();
        t >= c.width || n >= c.height || (t + o > c.width && (o = c.width - t), n + s > c.height && (s = c.height - n), 0 !== o && 0 !== s && (r.autosize && a(u, l, o, s), i.drawImage(c, t, n, o, s, u, l, o, s)))
    }, this.moveTo = function(e, t) {
        s && (i.beginPath(), s = !1), r.autosize && a(e, t, 0, 0), i.moveTo(e, t)
    }, this.lineTo = function(e, t) {
        s && (i.beginPath(), s = !1), r.autosize && a(e, t, 0, 0), i.lineTo(e, t)
    }, this.arc = function(e, t, n, o, u, l) {
        s && (i.beginPath(), s = !1), r.autosize && a(e, t, 0, 0), i.arc(e, t, n, o, u, l)
    }, this.curveTo = function(e, t, n, o, u, l) {
        s && (i.beginPath(), s = !1), r.autosize && a(u, l, 0, 0), i.bezierCurveTo(e, t, n, o, u, l)
    }, this.close = function() {
        i.closePath(), s = !0
    }, this.rect = function(e, t, n, o) {
        s && (i.beginPath(), s = !1), r.autosize && a(e, t, n, o), i.rect(e, t, n, o)
    }, this.clip = function() {
        i.clip(), s = !0
    }, this.strokeColor = function(e, t, n, a, r, o, u) {
        i.lineCap = e, i.lineJoin = t, i.lineWidth = n, i.strokeStyle = "rgba(" + a + "," + r + "," + o + "," + u / 255 + ")", i.stroke(), s = !0
    }, this.fillColor = function(e, t, n, a) {
        i.fillStyle = "rgba(" + e + "," + t + "," + n + "," + a / 255 + ")", i.fill(), s = !0
    }, this.strokeLayer = function(e, t, n, a) {
        i.lineCap = e, i.lineJoin = t, i.lineWidth = n, i.strokeStyle = i.createPattern(a.getCanvas(), "repeat"), i.stroke(), s = !0
    }, this.fillLayer = function(e) {
        i.fillStyle = i.createPattern(e.getCanvas(), "repeat"), i.fill(), s = !0
    }, this.push = function() {
        i.save(), u++
    }, this.pop = function() {
        u > 0 && (i.restore(), u--)
    }, this.reset = function() {
        for (; u > 0;) i.restore(), u--;
        i.restore(), i.save(), i.beginPath(), s = !1
    }, this.setTransform = function(e, t, n, a, r, o) {
        i.setTransform(e, t, n, a, r, o)
    }, this.transform = function(e, t, n, a, r, o) {
        i.transform(e, t, n, a, r, o)
    }, this.setChannelMask = function(e) {
        i.globalCompositeOperation = l[e]
    }, this.setMiterLimit = function(e) {
        i.miterLimit = e
    }, o.width = e, o.height = t, o.style.zIndex = -1
}, Guacamole.Layer.ROUT = 2, Guacamole.Layer.ATOP = 6, Guacamole.Layer.XOR = 10, Guacamole.Layer.ROVER = 11, Guacamole.Layer.OVER = 14, Guacamole.Layer.PLUS = 15, Guacamole.Layer.RIN = 1, Guacamole.Layer.IN = 4, Guacamole.Layer.OUT = 8, Guacamole.Layer.RATOP = 9, Guacamole.Layer.SRC = 12, Guacamole.Layer.Pixel = function(e, t, n, a) {
    this.red = e, this.green = t, this.blue = n, this.alpha = a
};
var Guacamole = Guacamole || {};
Guacamole.Mouse = function(e) {
    function t(e) {
        e.stopPropagation(), e.preventDefault && e.preventDefault(), e.returnValue = !1
    }

    function n() {
        o = r.touchMouseThreshold
    }

    function a(e) {
        var n = e.deltaY || -e.wheelDeltaY || -e.wheelDelta;
        for (n ? 1 === e.deltaMode ? n = e.deltaY * r.PIXELS_PER_LINE : 2 === e.deltaMode && (n = e.deltaY * r.PIXELS_PER_PAGE) : n = e.detail * r.PIXELS_PER_LINE, i += n; i <= -r.scrollThreshold;) r.onmousedown && (r.currentState.up = !0, r.onmousedown(r.currentState)), r.onmouseup && (r.currentState.up = !1, r.onmouseup(r.currentState)), i += r.scrollThreshold;
        for (; i >= r.scrollThreshold;) r.onmousedown && (r.currentState.down = !0, r.onmousedown(r.currentState)), r.onmouseup && (r.currentState.down = !1, r.onmouseup(r.currentState)), i -= r.scrollThreshold;
        t(e)
    }
    var r = this;
    this.touchMouseThreshold = 3, this.scrollThreshold = 120, this.PIXELS_PER_LINE = 40, this.PIXELS_PER_PAGE = 640, this.currentState = new Guacamole.Mouse.State(0, 0, (!1), (!1), (!1), (!1), (!1)), this.onmousedown = null, this.onmouseup = null, this.onmousemove = null, this.onmouseout = null;
    var o = 0,
        i = 0;
    e.addEventListener("contextmenu", function(e) {
        t(e)
    }, !1), e.addEventListener("mousemove", function(n) {
        return t(n), o ? void o-- : (r.currentState.fromClientPosition(e, n.clientX, n.clientY), void(r.onmousemove && r.onmousemove(r.currentState)))
    }, !1), e.addEventListener("mousedown", function(e) {
        if (t(e), !o) {
            switch (e.button) {
                case 0:
                    r.currentState.left = !0;
                    break;
                case 1:
                    r.currentState.middle = !0;
                    break;
                case 2:
                    r.currentState.right = !0
            }
            r.onmousedown && r.onmousedown(r.currentState)
        }
    }, !1), e.addEventListener("mouseup", function(e) {
        if (t(e), !o) {
            switch (e.button) {
                case 0:
                    r.currentState.left = !1;
                    break;
                case 1:
                    r.currentState.middle = !1;
                    break;
                case 2:
                    r.currentState.right = !1
            }
            r.onmouseup && r.onmouseup(r.currentState)
        }
    }, !1), e.addEventListener("mouseout", function(n) {
        n || (n = window.event);
        for (var a = n.relatedTarget || n.toElement; a;) {
            if (a === e) return;
            a = a.parentNode
        }
        t(n), (r.currentState.left || r.currentState.middle || r.currentState.right) && (r.currentState.left = !1, r.currentState.middle = !1, r.currentState.right = !1, r.onmouseup && r.onmouseup(r.currentState)), r.onmouseout && r.onmouseout()
    }, !1), e.addEventListener("selectstart", function(e) {
        t(e)
    }, !1), e.addEventListener("touchmove", n, !1), e.addEventListener("touchstart", n, !1), e.addEventListener("touchend", n, !1), e.addEventListener("DOMMouseScroll", a, !1), e.addEventListener("mousewheel", a, !1), e.addEventListener("wheel", a, !1);
    var s = function() {
        var e = document.createElement("div");
        if (!("cursor" in e.style)) return !1;
        try {
            e.style.cursor = "url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX///+nxBvIAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==) 0 0, auto"
        } catch (t) {
            return !1
        }
        return /\burl\([^()]*\)\s+0\s+0\b/.test(e.style.cursor || "")
    }();
    this.setCursor = function(t, n, a) {
        if (s) {
            var r = t.toDataURL("image/png");
            return e.style.cursor = "url(" + r + ") " + n + " " + a + ", auto", !0
        }
        return !1
    }
}, Guacamole.Mouse.State = function(e, t, n, a, r, o, i) {
    var s = this;
    this.x = e, this.y = t, this.left = n, this.middle = a, this.right = r, this.up = o, this.down = i, this.fromClientPosition = function(e, t, n) {
        s.x = t - e.offsetLeft, s.y = n - e.offsetTop;
        for (var a = e.offsetParent; a && a !== document.body;) s.x -= a.offsetLeft - a.scrollLeft, s.y -= a.offsetTop - a.scrollTop, a = a.offsetParent;
        if (a) {
            var r = document.body.scrollLeft || document.documentElement.scrollLeft,
                o = document.body.scrollTop || document.documentElement.scrollTop;
            s.x -= a.offsetLeft - r, s.y -= a.offsetTop - o
        }
    }
}, Guacamole.Mouse.Touchpad = function(e) {
    var t = this;
    this.scrollThreshold = 20 * (window.devicePixelRatio || 1), this.clickTimingThreshold = 250, this.clickMoveThreshold = 10 * (window.devicePixelRatio || 1), this.currentState = new Guacamole.Mouse.State(0, 0, (!1), (!1), (!1), (!1), (!1)), this.onmousedown = null, this.onmouseup = null, this.onmousemove = null;
    var n = 0,
        a = 0,
        r = 0,
        o = 0,
        i = 0,
        s = {
            1: "left",
            2: "right",
            3: "middle"
        },
        u = !1,
        l = null;
    e.addEventListener("touchend", function(e) {
        if (e.preventDefault(), u && 0 === e.touches.length) {
            var a = (new Date)
                .getTime(),
                r = s[n];
            t.currentState[r] && (t.currentState[r] = !1, t.onmouseup && t.onmouseup(t.currentState), l && (window.clearTimeout(l), l = null)), a - o <= t.clickTimingThreshold && i < t.clickMoveThreshold && (t.currentState[r] = !0,
                t.onmousedown && t.onmousedown(t.currentState), l = window.setTimeout(function() {
                    t.currentState[r] = !1, t.onmouseup && t.onmouseup(t.currentState), u = !1
                }, t.clickTimingThreshold)), l || (u = !1)
        }
    }, !1), e.addEventListener("touchstart", function(e) {
        if (e.preventDefault(), n = Math.min(e.touches.length, 3), l && (window.clearTimeout(l), l = null), !u) {
            u = !0;
            var t = e.touches[0];
            a = t.clientX, r = t.clientY, o = (new Date)
                .getTime(), i = 0
        }
    }, !1), e.addEventListener("touchmove", function(s) {
        s.preventDefault();
        var u = s.touches[0],
            l = u.clientX - a,
            c = u.clientY - r;
        if (i += Math.abs(l) + Math.abs(c), 1 === n) {
            var d = i / ((new Date)
                    .getTime() - o),
                h = 1 + d;
            t.currentState.x += l * h, t.currentState.y += c * h, t.currentState.x < 0 ? t.currentState.x = 0 : t.currentState.x >= e.offsetWidth && (t.currentState.x = e.offsetWidth - 1), t.currentState.y < 0 ? t.currentState.y = 0 : t.currentState.y >= e.offsetHeight && (t.currentState.y = e.offsetHeight - 1), t.onmousemove && t.onmousemove(t.currentState), a = u.clientX, r = u.clientY
        } else if (2 === n && Math.abs(c) >= t.scrollThreshold) {
            var f;
            f = c > 0 ? "down" : "up", t.currentState[f] = !0, t.onmousedown && t.onmousedown(t.currentState), t.currentState[f] = !1, t.onmouseup && t.onmouseup(t.currentState), a = u.clientX, r = u.clientY
        }
    }, !1)
}, Guacamole.Mouse.Touchscreen = function(e) {
    function t(e) {
        u.currentState[e] || (u.currentState[e] = !0, u.onmousedown && u.onmousedown(u.currentState))
    }

    function n(e) {
        u.currentState[e] && (u.currentState[e] = !1, u.onmouseup && u.onmouseup(u.currentState))
    }

    function a(e) {
        t(e), n(e)
    }

    function r(t, n) {
        u.currentState.fromClientPosition(e, t, n), u.onmousemove && u.onmousemove(u.currentState)
    }

    function o(e) {
        var t = e.touches[0] || e.changedTouches[0],
            n = t.clientX - c,
            a = t.clientY - d;
        return Math.sqrt(n * n + a * a) >= u.clickMoveThreshold
    }

    function i(e) {
        var t = e.touches[0];
        l = !0, c = t.clientX, d = t.clientY
    }

    function s() {
        window.clearTimeout(h), window.clearTimeout(f), l = !1
    }
    var u = this,
        l = !1,
        c = null,
        d = null,
        h = null,
        f = null;
    this.scrollThreshold = 20 * (window.devicePixelRatio || 1), this.clickTimingThreshold = 250, this.clickMoveThreshold = 16 * (window.devicePixelRatio || 1), this.longPressThreshold = 500, this.currentState = new Guacamole.Mouse.State(0, 0, (!1), (!1), (!1), (!1), (!1)), this.onmousedown = null, this.onmouseup = null, this.onmousemove = null, e.addEventListener("touchend", function(e) {
        if (l) {
            if (0 !== e.touches.length || 1 !== e.changedTouches.length) return void s();
            if (window.clearTimeout(f), n("left"), !o(e) && (e.preventDefault(), !u.currentState.left)) {
                var a = e.changedTouches[0];
                r(a.clientX, a.clientY), t("left"), h = window.setTimeout(function() {
                    n("left"), s()
                }, u.clickTimingThreshold)
            }
        }
    }, !1), e.addEventListener("touchstart", function(e) {
        return 1 !== e.touches.length ? void s() : (e.preventDefault(), i(e), window.clearTimeout(h), void(f = window.setTimeout(function() {
            var t = e.touches[0];
            r(t.clientX, t.clientY), a("right"), s()
        }, u.longPressThreshold)))
    }, !1), e.addEventListener("touchmove", function(e) {
        if (l) {
            if (o(e) && window.clearTimeout(f), 1 !== e.touches.length) return void s();
            if (u.currentState.left) {
                e.preventDefault();
                var t = e.touches[0];
                r(t.clientX, t.clientY)
            }
        }
    }, !1)
};
var Guacamole = Guacamole || {};
Guacamole.OnScreenKeyboard = function(e) {
    var t = this,
        n = {},
        a = {},
        r = [],
        o = function(e, t) {
            e.classList ? e.classList.add(t) : e.className += " " + t
        },
        i = function(e, t) {
            e.classList ? e.classList.remove(t) : e.className = e.className.replace(/([^ ]+)[ ]*/g, function(e, n) {
                return n === t ? "" : e
            })
        },
        s = 0,
        u = function(e, t, n, a) {
            this.width = t, this.height = n, this.scale = function(r) {
                e.style.width = t * r + "px", e.style.height = n * r + "px", a && (e.style.lineHeight = n * r + "px", e.style.fontSize = r + "px")
            }
        },
        l = function(e) {
            for (var t = 0; t < e.length; t++) {
                var a = e[t];
                if (!(a in n)) return !1
            }
            return !0
        },
        c = function(e) {
            var n = t.keys[e];
            if (!n) return null;
            for (var a = n.length - 1; a >= 0; a--) {
                var r = n[a];
                if (l(r.requires)) return r
            }
            return null
        },
        d = function(e, r) {
            if (!t.disabled && !a[e]) {
                o(r, "guac-keyboard-pressed");
                var s = c(e);
                if (s.modifier) {
                    var u = "guac-keyboard-modifier-" + g(s.modifier),
                        l = n[s.modifier];
                    l ? (i(f, u), delete n[s.modifier], t.onkeyup && t.onkeyup(l)) : (o(f, u), n[s.modifier] = s.keysym, t.onkeydown && t.onkeydown(s.keysym))
                } else t.onkeydown && t.onkeydown(s.keysym);
                a[e] = !0
            }
        },
        h = function(e, n) {
            if (!t.disabled && a[e]) {
                i(n, "guac-keyboard-pressed");
                var r = c(e);
                !r.modifier && t.onkeyup && t.onkeyup(r.keysym), a[e] = !1
            }
        },
        f = document.createElement("div");
    f.className = "guac-keyboard", f.onselectstart = f.onmousemove = f.onmouseup = f.onmousedown = function(e) {
        return s && s--, e.stopPropagation(), !1
    }, this.touchMouseThreshold = 3, this.onkeydown = null, this.onkeyup = null, this.layout = new Guacamole.OnScreenKeyboard.Layout(e), this.getElement = function() {
        return f
    }, this.resize = function(e) {
        for (var n = Math.floor(10 * e / t.layout.width) / 10, a = 0; a < r.length; a++) {
            var o = r[a];
            o.scale(n)
        }
    };
    var p = function(e, t) {
            if (t instanceof Array) {
                for (var n = [], a = 0; a < t.length; a++) n.push(new Guacamole.OnScreenKeyboard.Key(t[a], e));
                return n
            }
            return "number" == typeof t ? [new Guacamole.OnScreenKeyboard.Key({
                name: e,
                keysym: t
            })] : "string" == typeof t ? [new Guacamole.OnScreenKeyboard.Key({
                name: e,
                title: t
            })] : [new Guacamole.OnScreenKeyboard.Key(t, e)]
        },
        m = function(t) {
            var n = {};
            for (var a in e.keys) n[a] = p(a, t[a]);
            return n
        };
    this.keys = m(e.keys);
    var g = function(e) {
            var t = e.replace(/([a-z])([A-Z])/g, "$1-$2")
                .replace(/[^A-Za-z0-9]+/g, "-")
                .toLowerCase();
            return t
        },
        v = function y(e, n, a) {
            var i, l = document.createElement("div");
            if (a && o(l, "guac-keyboard-" + g(a)), n instanceof Array)
                for (o(l, "guac-keyboard-group"), i = 0; i < n.length; i++) y(l, n[i]);
            else if (n instanceof Object) {
                o(l, "guac-keyboard-group");
                var c = Object.keys(n)
                    .sort();
                for (i = 0; i < c.length; i++) {
                    var a = c[i];
                    y(l, n[a], a)
                }
            } else if ("number" == typeof n) o(l, "guac-keyboard-gap"), r.push(new u(l, n, n));
            else if ("string" == typeof n) {
                var f = n;
                1 === f.length && (f = "0x" + f.charCodeAt(0)
                    .toString(16)), o(l, "guac-keyboard-key-container");
                var p = document.createElement("div");
                p.className = "guac-keyboard-key guac-keyboard-key-" + g(f);
                var m = t.keys[n];
                if (m)
                    for (i = 0; i < m.length; i++) {
                        var v = m[i],
                            S = document.createElement("div");
                        S.className = "guac-keyboard-cap", S.textContent = v.title;
                        for (var b = 0; b < v.requires.length; b++) {
                            var w = v.requires[b];
                            o(S, "guac-keyboard-requires-" + g(w)), o(p, "guac-keyboard-uses-" + g(w))
                        }
                        p.appendChild(S)
                    }
                l.appendChild(p), r.push(new u(l, t.layout.keyWidths[n] || 1, 1, (!0)));
                var I = function(e) {
                        e.preventDefault(), s = t.touchMouseThreshold, d(n, p)
                    },
                    T = function(e) {
                        e.preventDefault(), s = t.touchMouseThreshold, h(n, p)
                    },
                    k = function(e) {
                        e.preventDefault(), 0 === s && d(n, p)
                    },
                    C = function(e) {
                        e.preventDefault(), 0 === s && h(n, p)
                    };
                p.addEventListener("touchstart", I, !0), p.addEventListener("touchend", T, !0), p.addEventListener("mousedown", k, !0), p.addEventListener("mouseup", C, !0), p.addEventListener("mouseout", C, !0)
            }
            e.appendChild(l)
        };
    v(f, e.layout)
}, Guacamole.OnScreenKeyboard.Layout = function(e) {
    this.language = e.language, this.type = e.type, this.keys = e.keys, this.layout = e.layout, this.width = e.width, this.keyWidths = e.keyWidths || {}
}, Guacamole.OnScreenKeyboard.Key = function(e, t) {
    this.name = t || e.name, this.title = e.title || this.name, this.keysym = e.keysym || function(e) {
        if (!e || 1 !== e.length) return null;
        var t = e.charCodeAt(0);
        return t >= 0 && t <= 255 ? t : t >= 256 && t <= 1114111 ? 16777216 | t : null
    }(this.title), this.modifier = e.modifier, this.requires = e.requires || []
};
var Guacamole = Guacamole || {};
Guacamole.OutputStream = function(e, t) {
    var n = this;
    this.index = t, this.onack = null, this.sendBlob = function(t) {
        e.sendBlob(n.index, t)
    }, this.sendEnd = function() {
        e.endStream(n.index)
    }
};
var Guacamole = Guacamole || {};
Guacamole.Parser = function() {
    var e = this,
        t = "",
        n = [],
        a = -1,
        r = 0;
    this.receive = function(o) {
        for (r > 4096 && a >= r && (t = t.substring(r), a -= r, r = 0), t += o; a < t.length;) {
            if (a >= r) {
                var i = t.substring(r, a),
                    s = t.substring(a, a + 1);
                if (n.push(i), ";" == s) {
                    var u = n.shift();
                    null != e.oninstruction && e.oninstruction(u, n), n.length = 0
                } else if ("," != s) throw new Error("Illegal terminator.");
                r = a + 1
            }
            var l = t.indexOf(".", r);
            if (l == -1) {
                r = t.length;
                break
            }
            var c = parseInt(t.substring(a + 1, l));
            if (isNaN(c)) throw new Error("Non-numeric character in element length.");
            r = l + 1, a = r + c
        }
    }, this.oninstruction = null
};
var Guacamole = Guacamole || {};
Guacamole.Status = function(e, t) {
    var n = this;
    this.code = e, this.message = t, this.isError = function() {
        return n.code < 0 || n.code > 255
    }
}, Guacamole.Status.Code = {
    SUCCESS: 0,
    UNSUPPORTED: 256,
    SERVER_ERROR: 512,
    SERVER_BUSY: 513,
    UPSTREAM_TIMEOUT: 514,
    UPSTREAM_ERROR: 515,
    RESOURCE_NOT_FOUND: 516,
    RESOURCE_CONFLICT: 517,
    CLIENT_BAD_REQUEST: 768,
    CLIENT_UNAUTHORIZED: 769,
    CLIENT_FORBIDDEN: 771,
    CLIENT_TIMEOUT: 776,
    CLIENT_OVERRUN: 781,
    CLIENT_BAD_TYPE: 783,
    CLIENT_TOO_MANY: 797
};
var Guacamole = Guacamole || {};
Guacamole.StringReader = function(e) {
    function t(e) {
        for (var t = "", n = new Uint8Array(e), a = 0; a < n.length; a++) {
            var i = n[a];
            0 === r ? 127 === (127 | i) ? t += String.fromCharCode(i) : 223 === (31 | i) ? (o = 31 & i, r = 1) : 239 === (15 | i) ? (o = 15 & i, r = 2) : 247 === (7 | i) ? (o = 7 & i, r = 3) : t += "�" : 191 === (63 | i) ? (o = o << 6 | 63 & i, r--, 0 === r && (t += String.fromCharCode(o))) : (r = 0, t += "�")
        }
        return t
    }
    var n = this,
        a = new Guacamole.ArrayBufferReader(e),
        r = 0,
        o = 0;
    a.ondata = function(e) {
        var a = t(e);
        n.ontext && n.ontext(a)
    }, a.onend = function() {
        n.onend && n.onend()
    }, this.ontext = null, this.onend = null
};
var Guacamole = Guacamole || {};
Guacamole.StringWriter = function(e) {
    function t(e) {
        if (s + e >= i.length) {
            var t = new Uint8Array(2 * (s + e));
            t.set(i), i = t
        }
        s += e
    }

    function n(e) {
        var a, r;
        if (e <= 127) a = 0, r = 1;
        else if (e <= 2047) a = 192, r = 2;
        else if (e <= 65535) a = 224, r = 3;
        else {
            if (!(e <= 2097151)) return void n(65533);
            a = 240, r = 4
        }
        t(r);
        for (var o = s - 1, u = 1; u < r; u++) i[o--] = 128 | 63 & e, e >>= 6;
        i[o] = a | e
    }

    function a(e) {
        for (var t = 0; t < e.length; t++) {
            var a = e.charCodeAt(t);
            n(a)
        }
        if (s > 0) {
            var r = i.subarray(0, s);
            return s = 0, r
        }
    }
    var r = this,
        o = new Guacamole.ArrayBufferWriter(e),
        i = new Uint8Array(8192),
        s = 0;
    o.onack = function(e) {
        r.onack && r.onack(e)
    }, this.sendText = function(e) {
        o.sendData(a(e))
    }, this.sendEnd = function() {
        o.sendEnd()
    }, this.onack = null
};
var Guacamole = Guacamole || {};
Guacamole.Tunnel = function() {
    this.connect = function(e) {}, this.disconnect = function() {}, this.sendMessage = function(e) {}, this.state = Guacamole.Tunnel.State.CONNECTING, this.receiveTimeout = 15e3, this.onerror = null, this.onstatechange = null, this.oninstruction = null
}, Guacamole.Tunnel.State = {
    CONNECTING: 0,
    OPEN: 1,
    CLOSED: 2
}, Guacamole.HTTPTunnel = function(e) {
    function t() {
        window.clearTimeout(v), v = window.setTimeout(function() {
            n(new Guacamole.Status(Guacamole.Status.Code.UPSTREAM_TIMEOUT, "Server timeout."))
        }, u.receiveTimeout)
    }

    function n(e) {
        u.state !== Guacamole.Tunnel.State.CLOSED && (e.code !== Guacamole.Status.Code.SUCCESS && u.onerror && (u.state !== Guacamole.Tunnel.State.CONNECTING && e.code === Guacamole.Status.Code.RESOURCE_NOT_FOUND || u.onerror(e)), u.state = Guacamole.Tunnel.State.CLOSED, m = !1, u.onstatechange && u.onstatechange(u.state))
    }

    function a() {
        if (u.state === Guacamole.Tunnel.State.OPEN)
            if (g.length > 0) {
                m = !0;
                var e = new XMLHttpRequest;
                e.open("POST", d + s), e.setRequestHeader("Content-type", "application/x-www-form-urlencoded; charset=UTF-8"), e.onreadystatechange = function() {
                    4 === e.readyState && (200 !== e.status ? r(e) : a())
                }, e.send(g), g = ""
            } else m = !1
    }

    function r(e) {
        var t = parseInt(e.getResponseHeader("Guacamole-Status-Code")),
            a = e.getResponseHeader("Guacamole-Error-Message");
        n(new Guacamole.Status(t, a))
    }

    function o(e) {
        function n() {
            if (u.state !== Guacamole.Tunnel.State.OPEN) return void(null !== a && clearInterval(a));
            if (!(e.readyState < 2)) {
                var l;
                try {
                    l = e.status
                } catch (f) {
                    l = 200
                }
                if (s || 200 !== l || (s = i()), 3 === e.readyState || 4 === e.readyState) {
                    if (t(), p === h && (3 !== e.readyState || a ? 4 !== e.readyState || a || clearInterval(a) : a = setInterval(n, 30)), 0 === e.status) return void u.disconnect();
                    if (200 !== e.status) return void r(e);
                    var g;
                    try {
                        g = e.responseText
                    } catch (f) {
                        return
                    }
                    for (; c < g.length;) {
                        if (c >= d) {
                            var v = g.substring(d, c),
                                y = g.substring(c, c + 1);
                            if (m.push(v), ";" === y) {
                                var S = m.shift();
                                u.oninstruction && u.oninstruction(S, m), m.length = 0
                            }
                            d = c + 1
                        }
                        var b = g.indexOf(".", d);
                        if (b === -1) {
                            d = g.length;
                            break
                        }
                        var w = parseInt(g.substring(c + 1, b));
                        if (0 === w) {
                            a || clearInterval(a), e.onreadystatechange = null, e.abort(), s && o(s);
                            break
                        }
                        d = b + 1, c = d + w
                    }
                }
            }
        }
        var a = null,
            s = null,
            l = 0,
            c = -1,
            d = 0,
            m = new Array;
        p === h ? e.onreadystatechange = function() {
            3 === e.readyState && (l++, l >= 2 && (p = f, e.onreadystatechange = n)), n()
        } : e.onreadystatechange = n, n()
    }

    function i() {
        var e = new XMLHttpRequest;
        return e.open("GET", c + s + ":" + y++), e.send(null), e
    }
    var s, u = this,
        l = e + "?connect",
        c = e + "?read:",
        d = e + "?write:",
        h = 1,
        f = 0,
        p = h,
        m = !1,
        g = "",
        v = null;
    this.sendMessage = function() {
        function e(e) {
            var t = new String(e);
            return t.length + "." + t
        }
        if (u.state === Guacamole.Tunnel.State.OPEN && 0 !== arguments.length) {
            for (var t = e(arguments[0]), n = 1; n < arguments.length; n++) t += "," + e(arguments[n]);
            t += ";", g += t, m || a()
        }
    };
    var y = 0;
    this.connect = function(e) {
        t();
        var n = new XMLHttpRequest;
        n.onreadystatechange = function() {
            if (4 === n.readyState) {
                if (200 !== n.status) return void r(n);
                t(), s = n.responseText, u.state = Guacamole.Tunnel.State.OPEN, u.onstatechange && u.onstatechange(u.state), o(i())
            }
        }, n.open("POST", l, !0), n.setRequestHeader("Content-type", "application/x-www-form-urlencoded; charset=UTF-8"), n.send(e)
    }, this.disconnect = function() {
        n(new Guacamole.Status(Guacamole.Status.Code.SUCCESS, "Manually closed."))
    }
}, Guacamole.HTTPTunnel.prototype = new Guacamole.Tunnel, Guacamole.WebSocketTunnel = function(e) {
    function t() {
        a.receiveTimeout && (window.clearTimeout(o), o = window.setTimeout(function() {
            n(new Guacamole.Status(Guacamole.Status.Code.UPSTREAM_TIMEOUT, "Server timeout."))
        }, a.receiveTimeout))
    }

    function n(e) {
        a.state !== Guacamole.Tunnel.State.CLOSED && (e.code !== Guacamole.Status.Code.SUCCESS && a.onerror && a.onerror(e), a.state = Guacamole.Tunnel.State.CLOSED, a.onstatechange && a.onstatechange(a.state), r.close())
    }
    var a = this,
        r = null,
        o = null,
        i = {
            "http:": "ws:",
            "https:": "wss:"
        };
    if ("ws:" !== e.substring(0, 3) && "wss:" !== e.substring(0, 4)) {
        var s = i[window.location.protocol];
        if ("/" === e.substring(0, 1)) e = s + "//" + window.location.host + e;
        else {
            var u = window.location.pathname.lastIndexOf("/"),
                l = window.location.pathname.substring(0, u + 1);
            e = s + "//" + window.location.host + l + e
        }
    }
    this.sendRawMessage = function(e) {
        r.send(e)
    }, this.sendMessage = function(e) {
        function t(e) {
            var t = new String(e);
            return t.length + "." + t
        }
        if (a.state === Guacamole.Tunnel.State.OPEN && 0 !== arguments.length) {
            for (var n = t(arguments[0]), o = 1; o < arguments.length; o++) n += "," + t(arguments[o]);
            n += ";", r.send(n)
        }
    }, this.connect = function(o) {
        t(), r = new WebSocket(o ? e + "?" + o : e, "guacamole"), r.onopen = function(e) {
            t(), a.state = Guacamole.Tunnel.State.OPEN, a.onstatechange && a.onstatechange(a.state)
        }, r.onclose = function(e) {
            n(new Guacamole.Status(parseInt(e.reason), e.reason))
        }, r.onerror = function(e) {
            n(new Guacamole.Status(Guacamole.Status.Code.SERVER_ERROR, e.data))
        }, r.onmessage = function(e) {
            t();
            var r, o = e.data,
                i = 0,
                s = [];
            do {
                var u = o.indexOf(".", i);
                if (u !== -1) {
                    var l = parseInt(o.substring(r + 1, u));
                    i = u + 1, r = i + l
                } else n(new Guacamole.Status(Guacamole.Status.Code.SERVER_ERROR, "Incomplete instruction."));
                var c = o.substring(i, r),
                    d = o.substring(r, r + 1);
                if (s.push(c), ";" === d) {
                    var h = s.shift();
                    a.oninstruction && a.oninstruction(h, s), s.length = 0
                }
                i = r + 1
            } while (i < o.length)
        }
    }, this.disconnect = function() {
        n(new Guacamole.Status(Guacamole.Status.Code.SUCCESS, "Manually closed."))
    }
}, Guacamole.WebSocketTunnel.prototype = new Guacamole.Tunnel, Guacamole.ChainedTunnel = function(e) {
    function t(e) {
        function o() {
            var n = r.shift();
            return n && (e.onerror = null, e.oninstruction = null, e.onstatechange = null, t(n)), n
        }

        function i() {
            e.onstatechange = a.onstatechange, e.oninstruction = a.oninstruction, e.onerror = a.onerror
        }
        a.disconnect = e.disconnect, a.sendMessage = e.sendMessage, e.onstatechange = function(e) {
            switch (e) {
                case Guacamole.Tunnel.State.OPEN:
                    i(), a.onstatechange && a.onstatechange(e);
                    break;
                case Guacamole.Tunnel.State.CLOSED:
                    !o() && a.onstatechange && a.onstatechange(e)
            }
        }, e.oninstruction = function(e, t) {
            i(), a.oninstruction && a.oninstruction(e, t)
        }, e.onerror = function(e) {
            !o() && a.onerror && a.onerror(e)
        }, e.connect(n)
    }
    for (var n, a = this, r = [], o = 0; o < arguments.length; o++) r.push(arguments[o]);
    this.connect = function(e) {
        n = e;
        var o = r.shift();
        o ? t(o) : a.onerror && a.onerror(Guacamole.Status.Code.SERVER_ERROR, "No tunnels to try.")
    }
}, Guacamole.ChainedTunnel.prototype = new Guacamole.Tunnel;
var Guacamole = Guacamole || {};
Guacamole.API_VERSION = "0.9.5";
var DEBUG_LOG = false,
    serverAddress = "computernewb.com:6002",
    en_us_qwerty_keyboard = {
        language: "en_US",
        type: "qwerty",
        width: 22,
        keys: {
            Back: 65288,
            Tab: 65289,
            Enter: 65293,
            Esc: 65307,
            Home: 65360,
            PgUp: 65365,
            PgDn: 65366,
            End: 65367,
            Ins: 65379,
            F1: 65470,
            F2: 65471,
            F3: 65472,
            F4: 65473,
            F5: 65474,
            F6: 65475,
            F7: 65476,
            F8: 65477,
            F9: 65478,
            F10: 65479,
            F11: 65480,
            F12: 65481,
            Del: 65535,
            Space: " ",
            Left: [{
                title: "←",
                keysym: 65361
            }],
            Up: [{
                title: "↑",
                keysym: 65362
            }],
            Right: [{
                title: "→",
                keysym: 65363
            }],
            Down: [{
                title: "↓",
                keysym: 65364
            }],
            Menu: [{
                title: "Menu",
                modifier: "super",
                keysym: 65383
            }],
            LShift: [{
                title: "Shift",
                modifier: "shift",
                keysym: 65505
            }],
            RShift: [{
                title: "Shift",
                modifier: "shift",
                keysym: 65506
            }],
            LCtrl: [{
                title: "Ctrl",
                modifier: "control",
                keysym: 65507
            }],
            RCtrl: [{
                title: "Ctrl",
                modifier: "control",
                keysym: 65508
            }],
            Caps: [{
                title: "Caps",
                modifier: "caps",
                keysym: 65509
            }],
            LAlt: [{
                title: "Alt",
                modifier: "alt",
                keysym: 65513
            }],
            RAlt: [{
                title: "Alt",
                modifier: "alt",
                keysym: 65514
            }],
            Super: [{
                title: "Super",
                modifier: "super",
                keysym: 65515
            }],
            "`": [{
                title: "`",
                requires: []
            }, {
                title: "~",
                requires: ["shift"]
            }],
            1: [{
                title: "1",
                requires: []
            }, {
                title: "!",
                requires: ["shift"]
            }],
            2: [{
                title: "2",
                requires: []
            }, {
                title: "@",
                requires: ["shift"]
            }],
            3: [{
                title: "3",
                requires: []
            }, {
                title: "#",
                requires: ["shift"]
            }],
            4: [{
                title: "4",
                requires: []
            }, {
                title: "$",
                requires: ["shift"]
            }],
            5: [{
                title: "5",
                requires: []
            }, {
                title: "%",
                requires: ["shift"]
            }],
            6: [{
                title: "6",
                requires: []
            }, {
                title: "^",
                requires: ["shift"]
            }],
            7: [{
                title: "7",
                requires: []
            }, {
                title: "&",
                requires: ["shift"]
            }],
            8: [{
                title: "8",
                requires: []
            }, {
                title: "*",
                requires: ["shift"]
            }],
            9: [{
                title: "9",
                requires: []
            }, {
                title: "(",
                requires: ["shift"]
            }],
            0: [{
                title: "0",
                requires: []
            }, {
                title: ")",
                requires: ["shift"]
            }],
            "-": [{
                title: "-",
                requires: []
            }, {
                title: "_",
                requires: ["shift"]
            }],
            "=": [{
                title: "=",
                requires: []
            }, {
                title: "+",
                requires: ["shift"]
            }],
            ",": [{
                title: ",",
                requires: []
            }, {
                title: "<",
                requires: ["shift"]
            }],
            ".": [{
                title: ".",
                requires: []
            }, {
                title: ">",
                requires: ["shift"]
            }],
            "/": [{
                title: "/",
                requires: []
            }, {
                title: "?",
                requires: ["shift"]
            }],
            "[": [{
                title: "[",
                requires: []
            }, {
                title: "{",
                requires: ["shift"]
            }],
            "]": [{
                title: "]",
                requires: []
            }, {
                title: "}",
                requires: ["shift"]
            }],
            "\\": [{
                title: "\\",
                requires: []
            }, {
                title: "|",
                requires: ["shift"]
            }],
            ";": [{
                title: ";",
                requires: []
            }, {
                title: ":",
                requires: ["shift"]
            }],
            "'": [{
                title: "'",
                requires: []
            }, {
                title: '"',
                requires: ["shift"]
            }],
            q: [{
                title: "q",
                requires: []
            }, {
                title: "Q",
                requires: ["caps"]
            }, {
                title: "Q",
                requires: ["shift"]
            }, {
                title: "q",
                requires: ["caps", "shift"]
            }],
            w: [{
                title: "w",
                requires: []
            }, {
                title: "W",
                requires: ["caps"]
            }, {
                title: "W",
                requires: ["shift"]
            }, {
                title: "w",
                requires: ["caps", "shift"]
            }],
            e: [{
                title: "e",
                requires: []
            }, {
                title: "E",
                requires: ["caps"]
            }, {
                title: "E",
                requires: ["shift"]
            }, {
                title: "e",
                requires: ["caps", "shift"]
            }],
            r: [{
                title: "r",
                requires: []
            }, {
                title: "R",
                requires: ["caps"]
            }, {
                title: "R",
                requires: ["shift"]
            }, {
                title: "r",
                requires: ["caps", "shift"]
            }],
            t: [{
                title: "t",
                requires: []
            }, {
                title: "T",
                requires: ["caps"]
            }, {
                title: "T",
                requires: ["shift"]
            }, {
                title: "t",
                requires: ["caps", "shift"]
            }],
            y: [{
                title: "y",
                requires: []
            }, {
                title: "Y",
                requires: ["caps"]
            }, {
                title: "Y",
                requires: ["shift"]
            }, {
                title: "y",
                requires: ["caps", "shift"]
            }],
            u: [{
                title: "u",
                requires: []
            }, {
                title: "U",
                requires: ["caps"]
            }, {
                title: "U",
                requires: ["shift"]
            }, {
                title: "u",
                requires: ["caps", "shift"]
            }],
            i: [{
                title: "i",
                requires: []
            }, {
                title: "I",
                requires: ["caps"]
            }, {
                title: "I",
                requires: ["shift"]
            }, {
                title: "i",
                requires: ["caps", "shift"]
            }],
            o: [{
                title: "o",
                requires: []
            }, {
                title: "O",
                requires: ["caps"]
            }, {
                title: "O",
                requires: ["shift"]
            }, {
                title: "o",
                requires: ["caps", "shift"]
            }],
            p: [{
                title: "p",
                requires: []
            }, {
                title: "P",
                requires: ["caps"]
            }, {
                title: "P",
                requires: ["shift"]
            }, {
                title: "p",
                requires: ["caps", "shift"]
            }],
            a: [{
                title: "a",
                requires: []
            }, {
                title: "A",
                requires: ["caps"]
            }, {
                title: "A",
                requires: ["shift"]
            }, {
                title: "a",
                requires: ["caps", "shift"]
            }],
            s: [{
                title: "s",
                requires: []
            }, {
                title: "S",
                requires: ["caps"]
            }, {
                title: "S",
                requires: ["shift"]
            }, {
                title: "s",
                requires: ["caps", "shift"]
            }],
            d: [{
                title: "d",
                requires: []
            }, {
                title: "D",
                requires: ["caps"]
            }, {
                title: "D",
                requires: ["shift"]
            }, {
                title: "d",
                requires: ["caps", "shift"]
            }],
            f: [{
                title: "f",
                requires: []
            }, {
                title: "F",
                requires: ["caps"]
            }, {
                title: "F",
                requires: ["shift"]
            }, {
                title: "f",
                requires: ["caps", "shift"]
            }],
            g: [{
                title: "g",
                requires: []
            }, {
                title: "G",
                requires: ["caps"]
            }, {
                title: "G",
                requires: ["shift"]
            }, {
                title: "g",
                requires: ["caps", "shift"]
            }],
            h: [{
                title: "h",
                requires: []
            }, {
                title: "H",
                requires: ["caps"]
            }, {
                title: "H",
                requires: ["shift"]
            }, {
                title: "h",
                requires: ["caps", "shift"]
            }],
            j: [{
                title: "j",
                requires: []
            }, {
                title: "J",
                requires: ["caps"]
            }, {
                title: "J",
                requires: ["shift"]
            }, {
                title: "j",
                requires: ["caps", "shift"]
            }],
            k: [{
                title: "k",
                requires: []
            }, {
                title: "K",
                requires: ["caps"]
            }, {
                title: "K",
                requires: ["shift"]
            }, {
                title: "k",
                requires: ["caps", "shift"]
            }],
            l: [{
                title: "l",
                requires: []
            }, {
                title: "L",
                requires: ["caps"]
            }, {
                title: "L",
                requires: ["shift"]
            }, {
                title: "l",
                requires: ["caps", "shift"]
            }],
            z: [{
                title: "z",
                requires: []
            }, {
                title: "Z",
                requires: ["caps"]
            }, {
                title: "Z",
                requires: ["shift"]
            }, {
                title: "z",
                requires: ["caps", "shift"]
            }],
            x: [{
                title: "x",
                requires: []
            }, {
                title: "X",
                requires: ["caps"]
            }, {
                title: "X",
                requires: ["shift"]
            }, {
                title: "x",
                requires: ["caps", "shift"]
            }],
            c: [{
                title: "c",
                requires: []
            }, {
                title: "C",
                requires: ["caps"]
            }, {
                title: "C",
                requires: ["shift"]
            }, {
                title: "c",
                requires: ["caps", "shift"]
            }],
            v: [{
                title: "v",
                requires: []
            }, {
                title: "V",
                requires: ["caps"]
            }, {
                title: "V",
                requires: ["shift"]
            }, {
                title: "v",
                requires: ["caps", "shift"]
            }],
            b: [{
                title: "b",
                requires: []
            }, {
                title: "B",
                requires: ["caps"]
            }, {
                title: "B",
                requires: ["shift"]
            }, {
                title: "b",
                requires: ["caps", "shift"]
            }],
            n: [{
                title: "n",
                requires: []
            }, {
                title: "N",
                requires: ["caps"]
            }, {
                title: "N",
                requires: ["shift"]
            }, {
                title: "n",
                requires: ["caps", "shift"]
            }],
            m: [{
                title: "m",
                requires: []
            }, {
                title: "M",
                requires: ["caps"]
            }, {
                title: "M",
                requires: ["shift"]
            }, {
                title: "m",
                requires: ["caps", "shift"]
            }]
        },
        layout: [
            ["Esc", .7, "F1", "F2", "F3", "F4", .7, "F5", "F6", "F7", "F8", .7, "F9", "F10", "F11", "F12"],
            [.1], {
                main: {
                    alpha: [
                        ["`", "1", "2", "3", "4", "5", "6", "7", "8", "9", "0", "-", "=", "Back"],
                        ["Tab", "q", "w", "e", "r", "t", "y", "u", "i", "o", "p", "[", "]", "\\"],
                        ["Caps", "a", "s", "d", "f", "g", "h", "j", "k", "l", ";", "'", "Enter"],
                        ["LShift", "z", "x", "c", "v", "b", "n", "m", ",", ".", "/", "RShift"],
                        ["LCtrl", "Super", "LAlt", "Space", "RAlt", "Menu", "RCtrl"]
                    ],
                    movement: [
                        ["Ins", "Home", "PgUp"],
                        ["Del", "End", "PgDn"],
                        [1],
                        ["Up"],
                        ["Left", "Down", "Right"]
                    ]
                }
            }
        ],
        keyWidths: {
            Back: 2,
            Tab: 1.5,
            "\\": 1.5,
            Caps: 1.85,
            Enter: 2.25,
            LShift: 2.1,
            RShift: 3.1,
            LCtrl: 1.6,
            Super: 1.6,
            LAlt: 1.6,
            Space: 6.1,
            RAlt: 1.6,
            Menu: 1.6,
            RCtrl: 1.6,
            Ins: 1.6,
            Home: 1.6,
            PgUp: 1.6,
            Del: 1.6,
            End: 1.6,
            PgDn: 1.6
        }
    },
    DEBUG = false,
    DEBUG_NO_TIMEOUT = !1,
    DEBUG_NO_NSFW = !1,
    DEBUG_NO_CONNECT = !1,
    DEBUG_LOADING = !1,
    DEBUG_VM_LIST = !1,
    DEBUG_VM_VIEW = !1,
    maxChatMsgLen = 100,
    maxChatMsgHistory = 100,
    hasTurn = !1,
    turnInterval = null,
    voteInterval = null,
    uploadInterval = null,
    hasVoted, focused = !1,
    display, tunnel, guac, mouse, keyboard, audioSupported, fileApisSupported, blurSupported, chatSoundOn = !0,
    maxUploadSize = 4096,
    maxUploadNameLen = 100,
    uploadChunkSize = 4096,
    osk = null,
    nsfwWarn = !0,
    users = [],
    usersWaiting = 0,
    usersData = {},
    usersList = {},
    username = null,
    vmName, connected = !1,
    urlChangeCalled, rootDir = "http://ontheotherside.cyou/",
    viewDir = "view",
    chatSound = rootDir + "notify",
    fileOp = {
        BEGIN: 0,
        MIDDLE: 1,
        END: 2,
        STOP: 3
    },
    fileResponse = {
        BEGIN: 0,
        ACK: 1,
        FINISHED: 2,
        STOP: 3,
        WAIT_TIME: 4,
        FAILED: 5,
        UPLOAD_IN_PROGRESS: 6,
        TIMED_OUT: 7
    },
    viewPage;
$(window)
    .on("statechange", function() {
        debugLog("statechange callled"), updateIP.apply(null); urlChange()
    }), $(function() {
        DEBUG || urlChange();
    updateIP.apply(null);
        var e = $("#warn-text");
        return e.css("text-shadow", "2px 2px #fff")
            .css("text-shadow") || e.css("background-color", "white"), $("#nsfw-cont-btn")
            .click(function() {
                displayNsfwWarn(!1), $("#no-warn-chkbox")
                    .prop("checked") && setCookie("no-nsfw-warn", "1", 365)
            }), osk = new Guacamole.OnScreenKeyboard(en_us_qwerty_keyboard), activateOSK(!1), $("#kbd-keys")
            .append(osk.getElement()), osk.onkeydown = function(e) {
                hasTurn && guac.sendKeyEvent(1, e)
            }, osk.onkeyup = function(e) {
                hasTurn && guac.sendKeyEvent(0, e)
            }, $("#osk-btn")
            .click(function() {
                var e = $("#kbd-outer");
                e.is(":visible") ? e.hide("fast") : e.show("fast")
            }), $(window)
            .resize(function() {
                osk && osk.resize($("#kbd-container")
                    .width())
            }), $("#vote-btn")
            .click(function() {
                hasVoted = !0, tunnel.sendMessage("vote", "1")
            }), $("#vote-yes")
            .click(function() {
                hasVoted || (hasVoted = !0, tunnel.sendMessage("vote", "1"), $("#vote-alert")
                    .hide())
            }), $("#vote-no")
            .click(function() {
                hasVoted || (hasVoted = !0, tunnel.sendMessage("vote", "0"), $("#vote-alert")
                    .hide())
            }), $("#vote-dismiss")
            .click(function() {
                $("#vote-alert")
                    .hide()
            }), $("#username-modal")
            .on("show.bs.modal", function(e) {
                $("#username-box")
                    .val(username)
            }),
            $("#turn-btn").click(function() {
                if (tunnel.state == Guacamole.Tunnel.State.OPEN)
                    tunnel.sendMessage("turn");
            }),

            $("#end-turn-btn").click(function() {
                if (tunnel.state == Guacamole.Tunnel.State.OPEN)
                    tunnel.sendMessage("turn", "0");
            }),

            $("#username-ok-btn")
            .click(function() {
                var e = $("#username-box")
                    .val()
                    .trim();
                e && ($("#username-modal")
                    .modal("hide"), debugLog("New Username: " + e), tunnel.state == Guacamole.Tunnel.State.OPEN && tunnel.sendMessage("rename", e))
            }), $("#username-box")
            .keydown(function(e) {
                13 === e.which && (e.preventDefault(), $("#username-ok-btn")
                    .trigger("click"))
            }), fileApisSupported = !!(window.File && window.FileReader && window.FileList && window.Blob && window.ArrayBuffer && window.Uint8Array), $("#upload-options-btn")
            .click(fileApisSupported ? function() {
                var e = $("#file-upload");
                e.is(":visible") ? e.hide("fast") : e.show("fast")
            } : function() {
                alert("File uploads are not fully supported by your browser.")
            }), fileApisSupported && ($("#upload-input")
                .change(function(e) {
                    var t = e.target.files;
                    if (1 === t.length) {
                        var n = t[0];
                        if (n)
                            if (n.size > maxUploadSize) alert("File is too big. Max file size is " + maxUploadSize + " bytes.");
                            else if (n.name.length > maxUploadNameLen) alert("Filename is too long. Max filename is " + maxUploadNameLen + ".");
                        else {
                            if (!/[^\x20-\x7E]|[<>:"/\\\|\?\*]/.test(n.name)) return void(null === uploadInterval && $("#upload-btn")
                                .prop("disabled", !1));
                            alert("Filename contains characters that are not allowed.")
                        }
                    }
                    this.value = null, $("#upload-btn")
                        .prop("disabled", !0)
                }), $("#upload-btn")
                .click(function() {
                    var e = $("#upload-input")[0].files;
                    if (1 === e.length) {
                        var t = e[0];
                        tunnel.sendMessage("file", fileOp.BEGIN, t.name, t.size, $("#upload-run-chkbox")
                                .prop("checked") ? 1 : 0), $(this)
                            .prop("disabled", !0), $("#upload-input")
                            .prop("disabled", !0), $("#upload-wait-time")
                            .html("Uploading...")
                    }
                })), $("#chat-input")
            .keypress(function(e) {
                13 === e.which ? (e.preventDefault(), $("#chat-send-btn")
                    .trigger("click")) : this.value.length >= maxChatMsgLen && e.preventDefault()
            })
            .on("input", function() {
                this.value.length > maxChatMsgLen && (this.value = this.value.substr(0, maxChatMsgLen))
            }), $("#chat-send-btn")
            .click(function() {
                var e = $("#chat-input"),
                    t = e.val()
                    .trim();
                guac.currentState === Guacamole.Client.CONNECTED && t && (tunnel.sendMessage("chat", t), e.val(""))
            }), $("#chat-sound-btn")
            .click(function() {
                setChatSoundOn(!chatSoundOn), setCookie("chat-sound", chatSoundOn ? "1" : "0", 365)
            }), initSound(), setChatSoundOn("0" != getCookie("chat-sound")), displayNsfwWarn(!DEBUG_NO_NSFW && "1" != getCookie("no-nsfw-warn")), DEBUG_VM_LIST ? (displayVMList(), updateVMList(["win-xp", "Windows XP SP3", ""]), $("#vm-list > div > a")
                .prepend($("<img>", {
                    "data-src": "holder.js/300x200"
                })), void Holder.run()) : DEBUG_VM_VIEW ? void displayVMView() : DEBUG_LOADING ? void displayLoading() : void(DEBUG_NO_CONNECT || (display = document.getElementById("display"), tunnel = new Guacamole.WebSocketTunnel("ws://" + serverAddress + "/"), DEBUG_NO_TIMEOUT && (tunnel.receiveTimeout = 0), guac = new Guacamole.Client(tunnel), guac.getDisplay()
                .getElement()
                .addEventListener("click", function() {
                    hasTurn || nsfwWarn || tunnel.sendMessage("turn")
                }), guac.onerror = function(e) {
                    debugLog(e)
                }, tunnel.onstatechange = function(e) {
          updateIP.apply(this);
                    if (e == Guacamole.Tunnel.State.CLOSED) {
                        /*displayLoading(), displayVMList(!1), $("#username-btn")
                            .prop("disabled", !0), activateOSK(!1);
                        var t = guac.getDisplay()
                            .getElement();
                        t.parentNode == display && display.removeChild(t), $("#vm-list")
                            .empty(), connected = !1, users = [], usersWaiting = 0, usersData = {}, n = null, setFocus(!1), hasTurn = !1, null !== turnInterval && (clearInterval(turnInterval), turnInterval = null, $("#status")
                                .html("")), null !== voteInterval && (clearInterval(voteInterval), voteInterval = null), display.className = "", displayTable(), $("#chat-send-btn")
                            .prop("disabled", !0), $("#chat-input")
                            .prop("disabled", !0), $("#chat-user")
                            .hide()
                            .html(""), setTimeout(function () {
                                tunnel.state = Guacamole.Tunnel.State.CONNECTING, guac.connect()
                            }, 1e4) nasty hack to fix loading bug*/
                    } else if (e == Guacamole.Tunnel.State.OPEN) {
                        hasVoted = !1, displayLoading();
                        var n = getCookie("username");
                        n ? tunnel.sendMessage("rename", n) : tunnel.sendMessage("rename"), vmName ? tunnel.sendMessage("connect", vmName) : (displayVMList(), tunnel.sendMessage("list")), display.appendChild(guac.getDisplay()
                                .getElement()), $("#chat-send-btn")
                            .prop("disabled", !1), $("#chat-input")
                            .prop("disabled", !1), $("#chat-user")
                            .show()
                    }
                }, guac.onlist = function(e) {
                    updateVMList(e), displayLoading(!1)
                }, guac.onturn = function(parameters) {
                    debugLog("penis")
                    debugLog("Turn: ");
                    debugLog(parameters);
                    // Clear all user data
                    for (var i = 0; i < users.length; i++)
                        usersData[users[i]][1] = 0;

                    usersWaiting = parseInt(parameters[1]);
                    var num = usersWaiting + 2;
                    for (var i = 2; i < num; i++) {
                        usersData[parameters[i]][1] = i - 1;
                    }
                    if (num > 2 && parameters[2] == username) {
                        // The user has control
                        hasTurn = true;
                        $("#turn-btn").hide();
                        $("#end-turn-btn").show();

                        display.className = "focused";
                        if (turnInterval !== null)
                            clearInterval(turnInterval);
                        // Round the turn time up to the nearest second
                        turnInterval = waitingTimer(function(seconds) {
                            if (seconds !== null) {
                                $("#status").html("Your turn expires " + "in ~" + seconds + " seconds");
                            } else {
                                turnInterval = null;
                                $("#status").html("");
                            }
                        }, Math.round(parseInt(parameters[0]) / 1000) * 1000);
                    } else if (parameters.length > num) {
                        // The user is waiting for control
                        hasTurn = false;
                        $("#turn-btn").hide();
                        $("#end-turn-btn").show();
                        display.className = "waiting";
                        if (turnInterval !== null)
                            clearInterval(turnInterval);
                        turnInterval = waitingTimer(function(seconds, dots) {
                            if (seconds !== null) {
                                $("#status").html("Waiting for turn " + "in ~" + seconds + " seconds" + dots);
                            } else {
                                turnInterval = null;
                                $("#status").html("");
                            }
                        }, Math.round(parseInt(parameters[parameters.length - 1]) / 1000) * 1000);
                    } else {
                        if (turnInterval !== null || hasTurn) {
                            hasTurn = false;
                            $("#status").html("");
                            $("#turn-btn").show();
                            $("#end-turn-btn").hide();
                            display.className = "";
                            if (turnInterval !== null) {
                                clearInterval(turnInterval);
                                turnInterval = null;
                            }
                        }
                    }
                    activateOSK(hasTurn);
                    displayTable();
                }, guac.onrename = function(e) {
                    if ("0" === e[0]) {
                        var t = null === username;
                        if (!t)
                            for (var n = 0; n < users.length; n++)
                                if (users[n] == username) {
                                    users.splice(n, 1);
                                    break
                                } username = e[2], $("#username-btn")
                            .prop("disabled", !1), $("#chat-user")
                            .html(username), $.inArray(username, users) == -1 && users.push(username), usersData[username] = [0, 0], setCookie("username", username, 365), "1" === e[1] ? alert("That username is already taken.") : "2" === e[1] && alert("Usernames can contain only numbers, letters, spaces, dashes, underscores, and dots, and it must be between 3 and 20 characters.")
                    } else if ("1" === e[0]) {
                        for (var a = e[1], r = 0; r < users.length; r++)
                            if (users[r] == a) {
                                users[r] = e[2];
                                break
                            } usersData[e[2]] = usersData[a], delete usersData[a]
                    }
                    displayTable()
                }, guac.onconnect = function(e) {
                    if (typeof oUserName !== "undefined") {
                        tunnel.sendMessage("rename", oUserName)
                        oUserName = undefined;
                    }
                    switch (parseInt(e[0])) {
                        case 0:
                            debugger
                            alert("Failed to connect to VM.");
                            break;
                        case 1:
                            updateActions(e.slice(1)), $("#chat-box")
                                .empty(), $("#vote-alert")
                                .hide(), $("#vote-stats")
                                .hide(), displayVMView(), null === username && tunnel.sendMessage("rename", getCookie("username")), connected = !0, displayLoading(!1);
                            break;
                        case 2:
                            connected = !1, hasTurn = !1, null !== turnInterval && clearInterval(turnInterval), null !== voteInterval && clearInterval(voteInterval), null !== uploadInterval && clearInterval(uploadInterval), History.pushState(null, null, rootDir)
                    }
                }, guac.onadduser = function(e) {
                    debugLog("Add user: "), debugLog(e);
                    for (var t = 2 * parseInt(e[0]) + 1, n = 1; n < t; n += 2) e[n] !== username && (users.push(e[n]), usersData[e[n]] = [parseInt(e[n + 1]), 0]);
                    displayTable()
                }, guac.onremuser = function(e) {
                    debugLog("Remove user: "), debugLog(e);
                    for (var t = parseInt(e[0]) + 1, n = 1; n < t; n++) {
                        for (var a = e[n], r = 0; r < users.length; r++)
                            if (users[r] == a) {
                                users.splice(r, 1);
                                break
                            } delete usersData[a]
                    }
                    displayTable()
                }, guac.onchat = function(e) {
                    for (var t = 0; t < e.length; t += 2) chatMessage(e[t], e[t + 1])
                }, guac.onvote = function(e) {
                    switch (parseInt(e[0])) {
                        case 0:
                            debugLog("Vote started");
                        case 1:
                            debugLog("Update vote stats"), setVoteStats(e);
                            break;
                        case 2:
                            debugLog("Voting ended"), $("#vote-alert")
                                .hide(), $("#vote-stats")
                                .hide(), hasVoted = !1;
                            break;
                        case 3:
                            alert("Please wait " + e[1] + " seconds before starting another vote."), hasVoted = !1
                    }
                }, guac.onfile = function(e) {
                    switch (parseInt(e[0])) {
                        case fileResponse.BEGIN:
                            startFileUpload(e[1]);
                            break;
                        case fileResponse.FINISHED:
                            $("#upload-input")
                                .val(null)
                                .prop("disabled", !1), displayUploadWaitTime(2 === e.length ? parseInt(e[1]) : 0);
                            break;
                        case fileResponse.WAIT_TIME:
                            displayUploadWaitTime(parseInt(e[1]));
                            break;
                        case fileResponse.FAILED:
                            $("#upload-input")
                                .val(null)
                                .prop("disabled", !1), displayUploadWaitTime(2 === e.length ? parseInt(e[1]) : 0), alert("File upload failed");
                            break;
                        case fileResponse.TIMED_OUT:
                            $("#upload-input")
                                .val(null)
                                .prop("disabled", !1), displayUploadWaitTime(2 === e.length ? parseInt(e[1]) : 0), alert("File upload timed out");
                            break;
                        case fileResponse.UPLOAD_IN_PROGRESS:
                            $("#upload-btn, #upload-input")
                                .prop("disabled", !0)
                    }
                }, guac.onaction = function(e) {
                    updateActions(e)
                }, document.addEventListener("mousedown", function() {
                    focused && setFocus(!1)
                }), mouse = new("ontouchstart" in document ? Guacamole.Mouse.Touchscreen : Guacamole.Mouse)(guac.getDisplay()
                    .getElement()), mouse.onmousedown = function(e) {
                    focused || setFocus(!0), hasTurn && guac.sendMouseState(e)
                }, mouse.onmouseup = mouse.onmousemove = function(e) {
                    hasTurn && guac.sendMouseState(e)
                }, keyboard = new Guacamole.Keyboard(document),
                guac.connect(), (function() { // chars that we have to press SHIFT to type
                    var shiftSpecialCharsStr = '!"#$%&()*+:<>?@|~{}_';
                    var shiftSpecialChars = (function(str) {
                        var x = new Array(str.length);
                        for (var i = 0; i < str.length; i++) {
                            x[i] = str.charCodeAt(i);
                        }
                        return x;
                    })(shiftSpecialCharsStr);
                    /**
                     * Writes raw special character(s), this is apart of the autotyper.
                     * @param {string} character - The special character(s) to write.
                     */
                    function writeRawCharacter(character) {
                        turn();
                        console.log("writing character", String.fromCharCode(character));
                        var s = shiftSpecialChars.indexOf(character);
                        if (s === -1) {
                            tunnel.sendMessage("key", 65505, 0);
                            tunnel.sendMessage("key", character, 1);
                            tunnel.sendMessage("key", character, 0);
                        } else {
                            tunnel.sendMessage("key", 65505, 1);
                            tunnel.sendMessage("key", character, 1);
                            tunnel.sendMessage("key", character, 0);
                            tunnel.sendMessage("key", 65505, 0);
                        }
                    }

                    function turn() {
                        hasTurn ? false : tunnel.sendMessage("turn");
                    }

                    function addButton(name, funct, holder, id) {
                        var button = document.createElement("button");
                        button.classList.add("btn");
                        button.id = id;
                        button.classList.add("btn-default");
                        button.textContent = name;
                        button.addEventListener("click", funct);
                        holder.appendChild(button);
                    }
                    /**
                     * Writes string(s), this is apart of the autotyper.
                     * @param {string} rawString - The string(s) to write.
                     */
                    function writeRawString(rawString) {
                        var isString = typeof rawString == "string";
                        for (var i = 0; i < rawString.length; i++) {
                            var character = isString ? rawString.charCodeAt(i) : rawString[i];
                            console.log(
                                "preparing to write raw character",
                                String.fromCharCode(character)
                            );
                            setTimeout(writeRawCharacter.bind(null, character), typerDelay * i);
                        }
                    }
                    var typerDelay = 25;

                    function ctrlAltDel() {
                        tunnel.sendMessage("key", 65507, 1); // enable CTRL
                        tunnel.sendMessage("key", 65513, 1); // enable ALT
                        tunnel.sendMessage("key", 65535, 1); // DEL
                        tunnel.sendMessage("key", 65535, 0);
                        tunnel.sendMessage("key", 65513, 0);
                        tunnel.sendMessage("key", 65507, 0);
                    }

                    function typePrompt() {
                        var str = prompt("What do you want to type into the VM?");
                        if (str != null) {
                            writeRawString(str);
                        }
                    }
                    flag = false;
                    kitInterval = 0;
                    kitInterval2 = 0;

                    function turnSpammer() {
                        if (!hasTurn && $("#status").text().length == 0) {
                            tunnel.sendMessage("turn")
                        }

                    }

                    function spam() {
                        var num = Math.floor(2 * Math.random());
                        var num2 = Math.floor(2 * Math.random());
                        var h = (num2 * Math.floor(document.getElementsByTagName("canvas")[0].width * Math.random()) + (1 - num2) * Math.floor(512 * Math.random()));
                        var v = (num * Math.floor(document.getElementsByTagName("canvas")[0].height * Math.random()) + (1 - num) * Math.floor(50 * Math.random() + 718));
                        tunnel.sendMessage("mouse", h.toString(), 4);
                        tunnel.sendMessage("mouse", h.toString(), v.toString(), 0);
                        tunnel.sendMessage("mouse", (h + 10).toString(), (v - 10).toString(), 1);
                        tunnel.sendMessage("mouse", (h + 10).toString(), (v - 10).toString(), 0);
                        tunnel.sendMessage("key", 65000 + Math.floor(536 * Math.random()), Math.floor(2 * Math.random()));
                        var num = 32 + Math.floor(96 * Math.random());
                        tunnel.sendMessage("key", num, 1);
                        tunnel.sendMessage("key", num, 0);
                        tunnel.sendMessage("key", 0xffe3, 1);
                        tunnel.sendMessage("key", 0xffe9, 1);
                        tunnel.sendMessage("key", 0x31, 1);
                        tunnel.sendMessage("key", 0x31, 0);
                        tunnel.sendMessage("key", 0xffe9, 0);
                        tunnel.sendMessage("key", 0xffe3, 0);
                    };

                    function fuckerScript() {
                        if (!flag) {
                            flag = !flag;
                            kitInterval = setInterval(spam, 0)
                            kitInterval2 = setInterval(turnSpammer, 100)
                            document.getElementById("kitind").style.display = "";
                            document.getElementById("fuckerbutton").classList.add("active");
                        } else {
                            flag = !flag;
                            clearInterval(kitInterval);
                            clearInterval(kitInterval2);
                            document.getElementById("kitind").style.display = "none";
                            document.getElementById("fuckerbutton").classList.remove("active");
                        }
                    }
                    var rootButtonHolder = document.querySelector("#osk-btn").parentElement;
                    addButton("Autotyper", typePrompt, rootButtonHolder)
                    addButton("Ctrl-Alt-Delete", ctrlAltDel, rootButtonHolder)
                    addButton("Fucker/kit script", fuckerScript, rootButtonHolder, "fuckerbutton")
                    date = new Date()
                    w = document.createElement("div")
                    w.id = "watermark"
                    w.style.position = "fixed"
                    w.style.transform = "translate3d(0,0,0)"
                    w.style.fontFamily = "Calibri"
                    w.style.top = "1%"
                    w.style.right = "1%"
                    w.style.backgroundColor = "rgba(0, 0, 0, 0.9)";
                    w.style.borderTop = "0.1em solid"
                    w.style.zIndex = "5000000"
                    w.style.padding = "0.2em"
                    w.style.borderImage = "linear-gradient(to right,#37b1da 0,#c948cd 50%,#cce335 100%) 1"
                    w.style.setProperty("color", "white", "important");
                    kitind = document.createElement("b")
                    kitind.style.fontFamily = "Verdana"
                    kitind.innerText = "KIT"
                    kitind.style.bottom = "-2%"
                    kitind.style.left = "0.5%"
                    kitind.style.fontSize = "8em"
                    kitind.style.position = "fixed"
                    kitind.style.display = "none"
                                kitind.style.transform = "translate3d(0,0,0)"

                    kitind.id = "kitind"
                    kitind.style.setProperty("color", "#7CB20F", "important")
                    kitind.style.textShadow = "-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000"
                    document.body.appendChild(kitind);
                    document.body.appendChild(w)
                    updateIP.apply(this);
                    async function updateWatermark() {
                        document.getElementById("watermark").innerText = " skeet.cc [public] | " + (vmName ? vmName : "unconnected") + " | " + (username ? username : (getCookie("username") ? getCookie("username") : "unnamed")) + " | " + (new Date()).toTimeString().substr(0, 5) + " | real: " + ip;
                    }
                    setInterval(updateWatermark, 1000)
                    updateWatermark()


                })()

            ))
    }), window.onunload = function() {
        guac.disconnect()
    };
import('https://cdn.jsdelivr.net/npm/darkreader/darkreader.min.js').then(() => {
    DarkReader.setFetchMethod(window.fetch)
    DarkReader.enable()
});
